<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>006-介绍一下 TCP 报文头部的字段 | Half Town前端周刊</title>
    <meta name="description" content="白糖炒栗子哒前端Blog">
    <link rel="icon" href="/favicon.ico">
  <link rel="mainfest" href="/mainfest.json">
    
    <link rel="preload" href="/assets/css/0.styles.d4c32f31.css" as="style"><link rel="preload" href="/assets/js/app.b1906b97.js" as="script"><link rel="preload" href="/assets/js/2.bdee5faf.js" as="script"><link rel="preload" href="/assets/js/15.a2d432ad.js" as="script"><link rel="preload" href="/assets/js/8.e132ed9d.js" as="script"><link rel="prefetch" href="/assets/js/10.e085a21c.js"><link rel="prefetch" href="/assets/js/100.78a0b04f.js"><link rel="prefetch" href="/assets/js/101.02ef3e98.js"><link rel="prefetch" href="/assets/js/102.cdd542e1.js"><link rel="prefetch" href="/assets/js/103.de748a03.js"><link rel="prefetch" href="/assets/js/104.7455cba5.js"><link rel="prefetch" href="/assets/js/105.68a805c9.js"><link rel="prefetch" href="/assets/js/106.a2ff7e85.js"><link rel="prefetch" href="/assets/js/107.36f34ab6.js"><link rel="prefetch" href="/assets/js/108.f26732f6.js"><link rel="prefetch" href="/assets/js/109.8d05e086.js"><link rel="prefetch" href="/assets/js/11.f2fd41dc.js"><link rel="prefetch" href="/assets/js/110.c7f84bd1.js"><link rel="prefetch" href="/assets/js/111.0cdf0d73.js"><link rel="prefetch" href="/assets/js/12.450e705b.js"><link rel="prefetch" href="/assets/js/13.50973e7a.js"><link rel="prefetch" href="/assets/js/14.40fad099.js"><link rel="prefetch" href="/assets/js/16.4ad6c82f.js"><link rel="prefetch" href="/assets/js/17.1bc86885.js"><link rel="prefetch" href="/assets/js/18.ade73665.js"><link rel="prefetch" href="/assets/js/19.a0f47a6e.js"><link rel="prefetch" href="/assets/js/20.5499b902.js"><link rel="prefetch" href="/assets/js/21.86afe090.js"><link rel="prefetch" href="/assets/js/22.29fa6f17.js"><link rel="prefetch" href="/assets/js/23.1af6f734.js"><link rel="prefetch" href="/assets/js/24.933ea1dd.js"><link rel="prefetch" href="/assets/js/25.7b5dc5f0.js"><link rel="prefetch" href="/assets/js/26.03194069.js"><link rel="prefetch" href="/assets/js/27.eb1fac5c.js"><link rel="prefetch" href="/assets/js/28.01df134d.js"><link rel="prefetch" href="/assets/js/29.697d4c02.js"><link rel="prefetch" href="/assets/js/3.77f61fb0.js"><link rel="prefetch" href="/assets/js/30.e1b58026.js"><link rel="prefetch" href="/assets/js/31.41db2b44.js"><link rel="prefetch" href="/assets/js/32.9f2db749.js"><link rel="prefetch" href="/assets/js/33.03b6d68a.js"><link rel="prefetch" href="/assets/js/34.09609909.js"><link rel="prefetch" href="/assets/js/35.c80be0ac.js"><link rel="prefetch" href="/assets/js/36.d15e6050.js"><link rel="prefetch" href="/assets/js/37.1ccd8184.js"><link rel="prefetch" href="/assets/js/38.ab0d4b98.js"><link rel="prefetch" href="/assets/js/39.8301eaad.js"><link rel="prefetch" href="/assets/js/4.90b687b0.js"><link rel="prefetch" href="/assets/js/40.d95907af.js"><link rel="prefetch" href="/assets/js/41.33845e14.js"><link rel="prefetch" href="/assets/js/42.8a256266.js"><link rel="prefetch" href="/assets/js/43.343b309f.js"><link rel="prefetch" href="/assets/js/44.e61b9da2.js"><link rel="prefetch" href="/assets/js/45.0eea8be7.js"><link rel="prefetch" href="/assets/js/46.861203d9.js"><link rel="prefetch" href="/assets/js/47.ae5bd907.js"><link rel="prefetch" href="/assets/js/48.1dbfd265.js"><link rel="prefetch" href="/assets/js/49.87f2ea7e.js"><link rel="prefetch" href="/assets/js/5.06355c1f.js"><link rel="prefetch" href="/assets/js/50.92bcf9cd.js"><link rel="prefetch" href="/assets/js/51.2b54e26b.js"><link rel="prefetch" href="/assets/js/52.ef61db16.js"><link rel="prefetch" href="/assets/js/53.e8411588.js"><link rel="prefetch" href="/assets/js/54.6f0a7cd7.js"><link rel="prefetch" href="/assets/js/55.40d0a721.js"><link rel="prefetch" href="/assets/js/56.76ff8ce6.js"><link rel="prefetch" href="/assets/js/57.cfea78e2.js"><link rel="prefetch" href="/assets/js/58.f8c35f3d.js"><link rel="prefetch" href="/assets/js/59.02cbb18a.js"><link rel="prefetch" href="/assets/js/6.d108277e.js"><link rel="prefetch" href="/assets/js/60.2df7b32b.js"><link rel="prefetch" href="/assets/js/61.16805fc4.js"><link rel="prefetch" href="/assets/js/62.ef5ca102.js"><link rel="prefetch" href="/assets/js/63.923718a5.js"><link rel="prefetch" href="/assets/js/64.d40092dd.js"><link rel="prefetch" href="/assets/js/65.d68a358c.js"><link rel="prefetch" href="/assets/js/66.b4323cbe.js"><link rel="prefetch" href="/assets/js/67.3a9004c1.js"><link rel="prefetch" href="/assets/js/68.350f6fbb.js"><link rel="prefetch" href="/assets/js/69.fdebae43.js"><link rel="prefetch" href="/assets/js/7.f0379e88.js"><link rel="prefetch" href="/assets/js/70.ccac64ba.js"><link rel="prefetch" href="/assets/js/71.8948f6c8.js"><link rel="prefetch" href="/assets/js/72.f5d07472.js"><link rel="prefetch" href="/assets/js/73.c2ddba1b.js"><link rel="prefetch" href="/assets/js/74.7a96d852.js"><link rel="prefetch" href="/assets/js/75.d452b4b5.js"><link rel="prefetch" href="/assets/js/76.5eac82cb.js"><link rel="prefetch" href="/assets/js/77.49a8f94c.js"><link rel="prefetch" href="/assets/js/78.17478c01.js"><link rel="prefetch" href="/assets/js/79.545a2920.js"><link rel="prefetch" href="/assets/js/80.172aeb42.js"><link rel="prefetch" href="/assets/js/81.6376c78a.js"><link rel="prefetch" href="/assets/js/82.1dfa8f89.js"><link rel="prefetch" href="/assets/js/83.fc10680d.js"><link rel="prefetch" href="/assets/js/84.41df0212.js"><link rel="prefetch" href="/assets/js/85.b57d2894.js"><link rel="prefetch" href="/assets/js/86.1bed09b1.js"><link rel="prefetch" href="/assets/js/87.3bc2e0cf.js"><link rel="prefetch" href="/assets/js/88.5797d5a1.js"><link rel="prefetch" href="/assets/js/89.cfc4d086.js"><link rel="prefetch" href="/assets/js/9.17617c7c.js"><link rel="prefetch" href="/assets/js/90.d3796c5b.js"><link rel="prefetch" href="/assets/js/91.f9e0f122.js"><link rel="prefetch" href="/assets/js/92.8ce6ae6a.js"><link rel="prefetch" href="/assets/js/93.f1c144ce.js"><link rel="prefetch" href="/assets/js/94.1877adf1.js"><link rel="prefetch" href="/assets/js/95.41ce2c18.js"><link rel="prefetch" href="/assets/js/96.07be3e30.js"><link rel="prefetch" href="/assets/js/97.d6ecd209.js"><link rel="prefetch" href="/assets/js/98.b1431a2d.js"><link rel="prefetch" href="/assets/js/99.acea4094.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4c32f31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Half Town前端周刊</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/posts/" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结前端技术文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6-11新特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入JavaScript系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS-API揭秘系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>搞懂那个TCP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network-tcp/001-base-concept/" class="sidebar-link">基础概念扫盲</a></li><li><a href="/network-tcp/002-tcp-udp/" class="sidebar-link">001-能不能说一说 TCP 和 UDP 的区别？</a></li><li><a href="/network-tcp/003-three-shake/" class="sidebar-link">002: 说说 TCP 三次握手的过程？为什么是三次而不是两次、四次？</a></li><li><a href="/network-tcp/004-four-shake/" class="sidebar-link">003: 说说 TCP 四次挥手的过程</a></li><li><a href="/network-tcp/005-tcp-reliable/" class="sidebar-link">004-TCP如何实现可靠传输</a></li><li><a href="/network-tcp/006-syn-accept-queue/" class="sidebar-link">005-说说半连接队列和 SYN Flood 攻击的关系</a></li><li><a href="/network-tcp/007-header/" class="active sidebar-link">006-介绍一下 TCP 报文头部的字段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#一、什么是报文？" class="sidebar-link">一、什么是报文？</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#二、tcp-首部各字段的意义和作用" class="sidebar-link">二、TCP 首部各字段的意义和作用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_1-源端口、目标端口" class="sidebar-link">1. 源端口、目标端口</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_2-序列号" class="sidebar-link">2. 序列号</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_3-isn" class="sidebar-link">3. ISN</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_4-确认号acknowledgement-number" class="sidebar-link">4. 确认号Acknowledgement Number</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_5-数据偏移-offset" class="sidebar-link">5. 数据偏移 Offset</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_6-保留-reserved" class="sidebar-link">6. 保留 Reserved</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_7-标记位-tcp-flags" class="sidebar-link">7. 标记位 TCP Flags</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_8-窗口大小window-size" class="sidebar-link">8. 窗口大小Window Size</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_9-校验和-tcp-checksum" class="sidebar-link">9. 校验和 TCP Checksum</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_10-紧急指针-urgent-pointer" class="sidebar-link">10. 紧急指针 Urgent Pointer</a></li><li class="sidebar-sub-header"><a href="/network-tcp/007-header/#_11-可选项" class="sidebar-link">11. 可选项</a></li></ul></li></ul></li><li><a href="/network-tcp/008-tcp-fast-open/" class="sidebar-link">007-说说 TCP 快速打开的原理(TFO)</a></li><li><a href="/network-tcp/009-timestamp/" class="sidebar-link">008-能不能说说TCP报文中时间戳的作用？</a></li><li><a href="/network-tcp/010-retransmission-timeout/" class="sidebar-link">009-TCP 的超时重传时间是如何计算的？</a></li><li><a href="/network-tcp/011-traffic-control/" class="sidebar-link">010-能不能说一说 TCP 的流量控制？</a></li><li><a href="/network-tcp/012-congestion-control/" class="sidebar-link">011-能不能说说 TCP 的拥塞控制？</a></li><li><a href="/network-tcp/013-nagle/" class="sidebar-link">012-能不能说说 Nagle 算法和延迟确认？</a></li><li><a href="/network-tcp/014-keep-alive/" class="sidebar-link">013-如何理解 TCP 的 keep-alive？</a></li><li><a href="/network-tcp/015-conclusion/" class="sidebar-link">014-总结</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>这个面试不太难</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写JS系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Koa大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端架构设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端模块化规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自动化测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue-cli的配置详解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_006-介绍一下-tcp-报文头部的字段"><a href="#_006-介绍一下-tcp-报文头部的字段" aria-hidden="true" class="header-anchor">#</a> 006-介绍一下 TCP 报文头部的字段</h1> <h2 id="一、什么是报文？"><a href="#一、什么是报文？" aria-hidden="true" class="header-anchor">#</a> 一、什么是报文？</h2> <p>例如一个 100kb 的 HTML 文档需要传送到另外一台计算机，并不会整个文档直接传送过去，可能会切割成几个部分，比如四个分别为 25kb 的数据段。
而每个数据段再加上一个 TCP 首部，就组成了 TCP 报文。</p> <p>一共四个 TCP 报文，发送到另外一个端。</p> <p>另外一端收到数据包，然后再剔除 TCP 首部，组装起来。</p> <p>等到四个数据包都收到了，就能还原出来一个完整的 HTML 文档了。</p> <blockquote><p>在 OSI 的七层协议中，第二层（数据链路层）的数据叫「Frame」，第三层（网络层）上的数据叫「Packet」，第四层（传输层）的数据叫「Segment」。</p></blockquote> <p>TCP 报文 (Segment)，包括首部和数据部分。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>而 TCP 的全部功能都体现在它首部中各字段的作用，只有弄清 TCP 首部各字段的作用才能掌握 TCP 的工作原理。
TCP 报文段首部的前20个字节是固定的，后面有 4N 字节是根据需要而增加的。
下图是把 TCP 报文中的首部放大来看。</p> <p><img src="/assets/img/message-head-structure.f5369ff7.png" alt=""></p> <p>TCP 的首部包括以下内容：</p> <ul><li>源端口 source port</li> <li>目的端口 destination port</li> <li>序号 sequence number</li> <li>确认号 acknowledgment number</li> <li>数据偏移 offset</li> <li>保留 reserved</li> <li>标志位 tcp flags</li> <li>窗口大小 window size</li> <li>检验和 checksum</li> <li>紧急指针 urgent pointer</li> <li>选项 tcp options</li></ul> <h2 id="二、tcp-首部各字段的意义和作用"><a href="#二、tcp-首部各字段的意义和作用" aria-hidden="true" class="header-anchor">#</a> 二、TCP 首部各字段的意义和作用</h2> <h3 id="_1-源端口、目标端口"><a href="#_1-源端口、目标端口" aria-hidden="true" class="header-anchor">#</a> 1. 源端口、目标端口</h3> <p>如何唯一标识一个连接？</p> <p>答案是 <strong>TCP 连接的四元组</strong>——<strong>源 IP、源端口</strong>、<strong>目标 IP 和目标端口</strong>。</p> <p>那 TCP 报文怎么没有源 IP 和目标 IP 呢？<strong>这是因为在 IP 层就已经处理了 IP 。TCP 只需要记录两者的端口即可。</strong></p> <p>源端口、目标端口各占 2 个 字节，共 4 个字节。</p> <p>用来告知主机该报文段是来自哪里以及传送给哪个应用程序（应用程序绑定了端口）的。
进行 TCP 通讯时，客户端通常使用系统自动选择的临时端口号，而服务器则使用设置的服务端口号。</p> <h3 id="_2-序列号"><a href="#_2-序列号" aria-hidden="true" class="header-anchor">#</a> 2. 序列号</h3> <p>即Sequence number, 指的是本报文段第一个字节的序列号。</p> <p>从图中可以看出，序列号长为 4 个字节，根据 8 位 = 1 字节，那么 4 个字节也就是 32 位的无符号整数，表示范围为 0 ~ 2^32 - 1。序号增加到最大值的时候，下一个序号又回到了 0.</p> <p>也就是说 TCP 协议可对 4GB 的数据进行编号，在一般情况下可保证当序号重复使用时，旧序号的数据早已经通过网络到达终点或者丢失了。</p> <p>序列号在 TCP 通信的过程中有两个作用:</p> <ol><li>在 SYN 报文中交换彼此的初始序列号。</li> <li>保证数据包按正确的顺序组装。</li></ol> <h3 id="_3-isn"><a href="#_3-isn" aria-hidden="true" class="header-anchor">#</a> 3. ISN</h3> <p>即Initial Sequence Number（初始序列号）, 在三次握手的过程当中，双方会用过SYN报文来交换彼此的 ISN。</p> <p>ISN 并不是一个固定的值，而是每 4 ms 加一，溢出则回到 0，这个算法使得猜测 ISN 变得很困难。那为什么要这么做？</p> <p>如果 ISN 被攻击者预测到，要知道源 IP 和源端口号都是很容易伪造的，当攻击者猜测 ISN 之后，直接伪造一个 RST 后，就可以强制连接关闭的，这是非常危险的。</p> <p>而动态增长的 ISN 大大提高了猜测 ISN 的难度。</p> <blockquote><p>补充阅读：</p> <p>比如：假设C和S正在进行TCP通信，X是破坏者，可以预测TCP ISN。X可能的攻击包括：</p> <p>一. 身份仿冒</p> <p>攻击过程简述如下：</p> <p>1）X首先对C进行攻击（比如Syn Flood），导致C不可用。</p> <p>2）然后X仿冒C的地址对S发起连接请求。</p> <p>3）S对C进行回应，附带ISN。注意：这个报文X是收不到的。</p> <p>4）X可以预测ISN，可以按预测的ISN直接给S回应确认，这时S误认为已经和C建立了连接。</p> <p>5）X这时就可以仿冒C的地址，发送恶意指令给S，S会认为这是C下发的指令，被欺骗执行，攻击生效。</p></blockquote> <p><img src="http://5b0988e595225.cdn.sohucs.com/images/20180910/2d469155623d4b859014f22b4f5b8836.png" alt="img"></p> <blockquote><p>这个攻击过程中，X不需要获得S的任何报文，就可以对S下发数据，这些数据可能是恶意指令，从而达到攻击的目的。</p> <p>二、DoS攻击</p> <p>因为X可以预测C和S的序列号，就可以在C和S通信的过程中，假冒一方的IP地址，频繁抢先一步发送错误的报文：</p> <p>1）发送序列号正确的ack报文，导致很多正确的报文被丢弃，TCP连接看上起正常，但是因为很多正确的报文被丢弃，实际处于拒绝服务状态。</p> <p>2）发送序列号正确的fin报文，导致TCP连接关闭，系统处于拒绝服务状态。</p> <p>三、信息投毒</p> <p>和DoS攻击类似，但属于更高级别的攻击。因为X可以预测ISN，就可以在通信过程中，假冒其中一方，使用正确的序列号抢先发送非法内容，而正确的报文在到达时被认为是重复的无效报文被丢弃。</p> <p>这种攻击需要对双方通信协议的内容有一定的了解，塞入的报文符合原来通信规格要求，被认为是合法报文进行了处理。</p></blockquote> <h3 id="_4-确认号acknowledgement-number"><a href="#_4-确认号acknowledgement-number" aria-hidden="true" class="header-anchor">#</a> 4. 确认号Acknowledgement Number</h3> <p>即ACK(Acknowledgment number)。占 4 个字节。表示期望收到对方下一个报文段的序号值，并且告诉对方<strong>小于ACK</strong>的所有字节已经全部收到。TCP 的可靠性，是建立在「每一个数据报文都需要确认收到」的基础之上的。</p> <h3 id="_5-数据偏移-offset"><a href="#_5-数据偏移-offset" aria-hidden="true" class="header-anchor">#</a> 5. 数据偏移 Offset</h3> <p>占 0.5 个字节 (4 位)。</p> <p>这个字段实际上是指出了 <code>TCP 报文段的首部长度</code> ，它指出了 TCP报文段的数据起始处 距离 TCP报文的起始处 有多远。（注意 数据起始处 和 报文起始处 的意思）</p> <p>一个数据偏移量 = 4 byte，由于 4 位二进制数能表示的最大十进制数字是 15，因此数据偏移的最大值是 60 byte，这也侧面限制了 TCP 首部的最大长度。</p> <h3 id="_6-保留-reserved"><a href="#_6-保留-reserved" aria-hidden="true" class="header-anchor">#</a> 6. 保留 Reserved</h3> <p>占 0.75 个字节 (6 位)。</p> <p>保留为今后使用，但目前应置为 0。</p> <h3 id="_7-标记位-tcp-flags"><a href="#_7-标记位-tcp-flags" aria-hidden="true" class="header-anchor">#</a> 7. 标记位 TCP Flags</h3> <p>标志位，一共有 6 个，分别占 1 位，共 6 位 。</p> <p>每一位的值只有 0 和 1，分别表达不同意思。</p> <p>标记位有URG, ACK, , PSH, RST, SYN, FIN。</p> <table><thead><tr><th>控制位</th> <th>作用</th></tr></thead> <tbody><tr><td>URG</td> <td>紧急指针，告诉接收TCP模块紧要指针域指着紧要数据</td></tr> <tr><td>ACK</td> <td>置1时表示确认号合法，为0的时候表示数据段不包含确认信息，确认号被忽略</td></tr> <tr><td>PSH</td> <td>置1时请求的数据段在接收方得到后就可直接送到应用程序，而不必等到缓冲区满时才传送</td></tr> <tr><td>RST</td> <td>置1时重建连接。如果接收到RST位时候，通常发生了某些错</td></tr> <tr><td>SYN</td> <td>置1时用来发起一个连接</td></tr> <tr><td>FIN</td> <td>置1时表示发端完成发送任务。用来释放连接，表明发送方已经没有数据发送了</td></tr></tbody></table> <p>SYN 和 ACK 已经在上文说过，后三个解释如下:</p> <p>FIN： 即 Finish，表示发送方准备断开连接。</p> <p>RST：即 Reset，用来强制断开连接。</p> <p>PSH： 即 Push, 告知对方这些数据包收到后应该马上交给上层的应用，不能缓存。</p> <h4 id="紧急-urg-urgent"><a href="#紧急-urg-urgent" aria-hidden="true" class="header-anchor">#</a> 紧急 URG (Urgent)</h4> <p>当 URG = 1 的时候，表示紧急指针（Urgent Pointer）有效。</p> <p>它告诉系统此报文段中有紧急数据，应尽快传送，而不要按原来的排队顺序来传送。</p> <p>URG 要与首部中的 紧急指针 字段配合使用。</p> <h4 id="确认-ack-acknowledgement"><a href="#确认-ack-acknowledgement" aria-hidden="true" class="header-anchor">#</a> 确认 ACK (Acknowledgement)</h4> <p>当 ACK = 1 的时候，确认号（Acknowledgemt Number）有效。</p> <p>一般称携带 ACK 标志的 TCP 报文段为「确认报文段」。</p> <p>TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 设置为 1。</p> <h4 id="推送-psh-push"><a href="#推送-psh-push" aria-hidden="true" class="header-anchor">#</a> 推送 PSH (Push)</h4> <p>当 PSH = 1 的时候，表示该报文段高优先级，接收方 TCP 应该尽快推送给接收应用程序，而不用等到整个 TCP 缓存都填满了后再交付。</p> <h4 id="复位-rst-reset"><a href="#复位-rst-reset" aria-hidden="true" class="header-anchor">#</a> 复位 RST (Reset)</h4> <p>当 RST = 1 的时候，表示 TCP 连接中出现严重错误，需要释放并重新建立连接。</p> <p>一般称携带 RST 标志的 TCP 报文段为「复位报文段」。</p> <h4 id="同步-syn-synchronization"><a href="#同步-syn-synchronization" aria-hidden="true" class="header-anchor">#</a> 同步 SYN (SYNchronization)</h4> <p>当 SYN = 1 的时候，表明这是一个请求连接报文段。</p> <p>一般称携带 SYN 标志的 TCP 报文段为「同步报文段」。</p> <p>在 TCP 三次握手中的第一个报文就是同步报文段，在连接建立时用来同步序号。</p> <p>对方若同意建立连接，则应在响应的报文段中使 SYN = 1 和 ACK = 1。</p> <h4 id="终止-fin-finish"><a href="#终止-fin-finish" aria-hidden="true" class="header-anchor">#</a> 终止 FIN (Finish)</h4> <p>当 FIN = 1 时，表示此报文段的发送方的数据已经发送完毕，并要求释放 TCP 连接。</p> <p>一般称携带 FIN 的报文段为「结束报文段」。</p> <p>在 TCP 四次挥手释放连接的时候，就会用到该标志。</p> <h3 id="_8-窗口大小window-size"><a href="#_8-窗口大小window-size" aria-hidden="true" class="header-anchor">#</a> 8. 窗口大小Window Size</h3> <p>占 2 字节，也就是 16 位。</p> <p>该字段明确指出了现在允许对方发送的数据量，它告诉对方本端的 TCP 接收缓冲区还能容纳多少字节的数据，这样对方就可以控制发送数据的速度。</p> <p>窗口大小的值是指，从本报文段首部中的确认号算起，接收方目前允许对方发送的数据量。</p> <p>例如，假如确认号是 701 ，窗口字段是 1000。这就表明，从 701 号算起，发送此报文段的一方还有接收 1000 （字节序号是 701 ~ 1700） 个字节的数据的接收缓存空间。</p> <p>但实际上窗口大小是不够用的。</p> <p>因此 TCP 引入了窗口缩放的选项，作为窗口缩放的比例因子，这个比例因子的范围在 0 ~ 14，比例因子可以将窗口的值扩大为原来的 2 ^ n 次方。</p> <h3 id="_9-校验和-tcp-checksum"><a href="#_9-校验和-tcp-checksum" aria-hidden="true" class="header-anchor">#</a> 9. 校验和 TCP Checksum</h3> <p>占用两个字节，防止传输过程中数据包有损坏，如果遇到校验和有差错的报文，TCP 直接丢弃之，等待重传。</p> <h3 id="_10-紧急指针-urgent-pointer"><a href="#_10-紧急指针-urgent-pointer" aria-hidden="true" class="header-anchor">#</a> 10. 紧急指针 Urgent Pointer</h3> <p>占 2 个字节。</p> <p>仅在 URG = 1 时才有意义，它指出本报文段中的紧急数据的字节数。</p> <p>当 URG = 1 时，发送方 TCP 就把紧急数据插入到本报文段数据的最前面，而在紧急数据后面的数据仍是普通数据。</p> <p>因此，紧急指针指出了紧急数据的末尾在报文段中的位置。</p> <h3 id="_11-可选项"><a href="#_11-可选项" aria-hidden="true" class="header-anchor">#</a> 11. 可选项</h3> <p>常用的可选项有以下几个:</p> <p>- TimeStamp: TCP 时间戳，后面详细介绍。 -</p> <p>MSS: 指的是 TCP 允许的从对方接收的最大报文段。</p> <p>- SACK: 选择确认选项。</p> <p>- Window Scale： 窗口缩放选项。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">4/4/2020, 5:42:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/network-tcp/006-syn-accept-queue/" class="prev">
          005-说说半连接队列和 SYN Flood 攻击的关系
        </a></span> <span class="next"><a href="/network-tcp/008-tcp-fast-open/">
          007-说说 TCP 快速打开的原理(TFO)
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b1906b97.js" defer></script><script src="/assets/js/2.bdee5faf.js" defer></script><script src="/assets/js/15.a2d432ad.js" defer></script><script src="/assets/js/8.e132ed9d.js" defer></script>
  </body>
</html>
