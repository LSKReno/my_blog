<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>004-常用Koa  API | Half Town前端周刊</title>
    <meta name="description" content="白糖炒栗子哒前端Blog">
    <link rel="icon" href="/favicon.ico">
  <link rel="mainfest" href="/mainfest.json">
    
    <link rel="preload" href="/assets/css/0.styles.d4c32f31.css" as="style"><link rel="preload" href="/assets/js/app.83679c7a.js" as="script"><link rel="preload" href="/assets/js/2.60600da5.js" as="script"><link rel="preload" href="/assets/js/76.5eac82cb.js" as="script"><link rel="preload" href="/assets/js/8.e132ed9d.js" as="script"><link rel="prefetch" href="/assets/js/10.525d65fb.js"><link rel="prefetch" href="/assets/js/100.78a0b04f.js"><link rel="prefetch" href="/assets/js/101.02ef3e98.js"><link rel="prefetch" href="/assets/js/102.cdd542e1.js"><link rel="prefetch" href="/assets/js/103.de748a03.js"><link rel="prefetch" href="/assets/js/104.7455cba5.js"><link rel="prefetch" href="/assets/js/105.68a805c9.js"><link rel="prefetch" href="/assets/js/106.f3e8ee0f.js"><link rel="prefetch" href="/assets/js/107.25388a22.js"><link rel="prefetch" href="/assets/js/108.f26732f6.js"><link rel="prefetch" href="/assets/js/109.8d05e086.js"><link rel="prefetch" href="/assets/js/11.f2fd41dc.js"><link rel="prefetch" href="/assets/js/110.c7f84bd1.js"><link rel="prefetch" href="/assets/js/111.0cdf0d73.js"><link rel="prefetch" href="/assets/js/12.450e705b.js"><link rel="prefetch" href="/assets/js/13.e434b17c.js"><link rel="prefetch" href="/assets/js/14.40fad099.js"><link rel="prefetch" href="/assets/js/15.a2d432ad.js"><link rel="prefetch" href="/assets/js/16.0719cdd7.js"><link rel="prefetch" href="/assets/js/17.1bc86885.js"><link rel="prefetch" href="/assets/js/18.ade73665.js"><link rel="prefetch" href="/assets/js/19.a0f47a6e.js"><link rel="prefetch" href="/assets/js/20.5499b902.js"><link rel="prefetch" href="/assets/js/21.86afe090.js"><link rel="prefetch" href="/assets/js/22.1754ffb2.js"><link rel="prefetch" href="/assets/js/23.1af6f734.js"><link rel="prefetch" href="/assets/js/24.933ea1dd.js"><link rel="prefetch" href="/assets/js/25.964d4ca5.js"><link rel="prefetch" href="/assets/js/26.03194069.js"><link rel="prefetch" href="/assets/js/27.eb1fac5c.js"><link rel="prefetch" href="/assets/js/28.01df134d.js"><link rel="prefetch" href="/assets/js/29.697d4c02.js"><link rel="prefetch" href="/assets/js/3.77f61fb0.js"><link rel="prefetch" href="/assets/js/30.e1b58026.js"><link rel="prefetch" href="/assets/js/31.41db2b44.js"><link rel="prefetch" href="/assets/js/32.9f2db749.js"><link rel="prefetch" href="/assets/js/33.03b6d68a.js"><link rel="prefetch" href="/assets/js/34.09609909.js"><link rel="prefetch" href="/assets/js/35.c80be0ac.js"><link rel="prefetch" href="/assets/js/36.d15e6050.js"><link rel="prefetch" href="/assets/js/37.1ccd8184.js"><link rel="prefetch" href="/assets/js/38.ab0d4b98.js"><link rel="prefetch" href="/assets/js/39.8301eaad.js"><link rel="prefetch" href="/assets/js/4.6194dbd9.js"><link rel="prefetch" href="/assets/js/40.d95907af.js"><link rel="prefetch" href="/assets/js/41.33845e14.js"><link rel="prefetch" href="/assets/js/42.8a256266.js"><link rel="prefetch" href="/assets/js/43.343b309f.js"><link rel="prefetch" href="/assets/js/44.e61b9da2.js"><link rel="prefetch" href="/assets/js/45.0eea8be7.js"><link rel="prefetch" href="/assets/js/46.861203d9.js"><link rel="prefetch" href="/assets/js/47.ae5bd907.js"><link rel="prefetch" href="/assets/js/48.1dbfd265.js"><link rel="prefetch" href="/assets/js/49.87f2ea7e.js"><link rel="prefetch" href="/assets/js/5.db08a2c0.js"><link rel="prefetch" href="/assets/js/50.92bcf9cd.js"><link rel="prefetch" href="/assets/js/51.c562d968.js"><link rel="prefetch" href="/assets/js/52.4d4ada28.js"><link rel="prefetch" href="/assets/js/53.be6b30c6.js"><link rel="prefetch" href="/assets/js/54.6f0a7cd7.js"><link rel="prefetch" href="/assets/js/55.40d0a721.js"><link rel="prefetch" href="/assets/js/56.76ff8ce6.js"><link rel="prefetch" href="/assets/js/57.cfea78e2.js"><link rel="prefetch" href="/assets/js/58.f8c35f3d.js"><link rel="prefetch" href="/assets/js/59.582b2818.js"><link rel="prefetch" href="/assets/js/6.d108277e.js"><link rel="prefetch" href="/assets/js/60.10b60142.js"><link rel="prefetch" href="/assets/js/61.244f1038.js"><link rel="prefetch" href="/assets/js/62.ef5ca102.js"><link rel="prefetch" href="/assets/js/63.0ae2648e.js"><link rel="prefetch" href="/assets/js/64.b0dd5067.js"><link rel="prefetch" href="/assets/js/65.1677a063.js"><link rel="prefetch" href="/assets/js/66.b4323cbe.js"><link rel="prefetch" href="/assets/js/67.3a9004c1.js"><link rel="prefetch" href="/assets/js/68.717fe160.js"><link rel="prefetch" href="/assets/js/69.d59b9fba.js"><link rel="prefetch" href="/assets/js/7.f0379e88.js"><link rel="prefetch" href="/assets/js/70.6f0c895a.js"><link rel="prefetch" href="/assets/js/71.8948f6c8.js"><link rel="prefetch" href="/assets/js/72.f5d07472.js"><link rel="prefetch" href="/assets/js/73.e9439bab.js"><link rel="prefetch" href="/assets/js/74.7a96d852.js"><link rel="prefetch" href="/assets/js/75.d452b4b5.js"><link rel="prefetch" href="/assets/js/77.49a8f94c.js"><link rel="prefetch" href="/assets/js/78.17478c01.js"><link rel="prefetch" href="/assets/js/79.545a2920.js"><link rel="prefetch" href="/assets/js/80.172aeb42.js"><link rel="prefetch" href="/assets/js/81.6376c78a.js"><link rel="prefetch" href="/assets/js/82.1dfa8f89.js"><link rel="prefetch" href="/assets/js/83.fc10680d.js"><link rel="prefetch" href="/assets/js/84.41df0212.js"><link rel="prefetch" href="/assets/js/85.b57d2894.js"><link rel="prefetch" href="/assets/js/86.1bed09b1.js"><link rel="prefetch" href="/assets/js/87.3bc2e0cf.js"><link rel="prefetch" href="/assets/js/88.5797d5a1.js"><link rel="prefetch" href="/assets/js/89.cfc4d086.js"><link rel="prefetch" href="/assets/js/9.17617c7c.js"><link rel="prefetch" href="/assets/js/90.d3796c5b.js"><link rel="prefetch" href="/assets/js/91.f9e0f122.js"><link rel="prefetch" href="/assets/js/92.8ce6ae6a.js"><link rel="prefetch" href="/assets/js/93.f1c144ce.js"><link rel="prefetch" href="/assets/js/94.1877adf1.js"><link rel="prefetch" href="/assets/js/95.41ce2c18.js"><link rel="prefetch" href="/assets/js/96.07be3e30.js"><link rel="prefetch" href="/assets/js/97.d6ecd209.js"><link rel="prefetch" href="/assets/js/98.b1431a2d.js"><link rel="prefetch" href="/assets/js/99.acea4094.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4c32f31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Half Town前端周刊</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/posts/" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结前端技术文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6-11新特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入JavaScript系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS-API揭秘系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搞懂那个TCP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>这个面试不太难</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写JS系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Koa大赏</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/koa/001-koa-src-code/001-4-src-code/" class="sidebar-link">001-Koa源码解读：四大核心文件</a></li><li><a href="/koa/001-koa-src-code/002-compose/" class="sidebar-link">002-Koa源码解读：洋葱模型</a></li><li><a href="/koa/001-koa-src-code/003-error-handle/" class="sidebar-link">003-Koa源码解读：错误处理</a></li><li><a href="/koa/005-koa-api/" class="active sidebar-link">004-常用Koa  API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa/005-koa-api/#koa-支持的配置" class="sidebar-link">koa 支持的配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa/005-koa-api/#_1-应用配置是-app-实例属性，目前支持的配置项如下" class="sidebar-link">1. 应用配置是 app 实例属性，目前支持的配置项如下</a></li><li class="sidebar-sub-header"><a href="/koa/005-koa-api/#_2-上下文相关" class="sidebar-link">2. 上下文相关</a></li><li class="sidebar-sub-header"><a href="/koa/005-koa-api/#_3-请求request" class="sidebar-link">3. 请求request</a></li><li class="sidebar-sub-header"><a href="/koa/005-koa-api/#_4-响应-response" class="sidebar-link">4. 响应(Response)</a></li></ul></li></ul></li><li><a href="/koa/006-koa-reflect-metadata/" class="sidebar-link">006 - Reflect Metadata 简单入门</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端架构设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端模块化规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自动化测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue-cli的配置详解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_004-常用koa-api"><a href="#_004-常用koa-api" aria-hidden="true" class="header-anchor">#</a> 004-常用Koa  API</h1> <h2 id="koa-支持的配置"><a href="#koa-支持的配置" aria-hidden="true" class="header-anchor">#</a> koa 支持的配置</h2> <h3 id="_1-应用配置是-app-实例属性，目前支持的配置项如下"><a href="#_1-应用配置是-app-实例属性，目前支持的配置项如下" aria-hidden="true" class="header-anchor">#</a> 1. 应用配置是 app 实例属性，目前支持的配置项如下</h3> <table><thead><tr><th>配置项名称</th> <th>简介</th></tr></thead> <tbody><tr><td>app.name</td> <td>应用名称（可选项）</td></tr> <tr><td>app.env</td> <td>默认为 NODE_ENV 或者 development</td></tr> <tr><td>app.proxy</td> <td>如果为 true，则解析 &quot;Host&quot; 的 header 域，并支持 X-Forwarded-Host</td></tr> <tr><td>app.subdomainOffset</td> <td>默认为2，表示 .subdomains 所忽略的字符偏移量。</td></tr></tbody></table> <hr> <h3 id="_2-上下文相关"><a href="#_2-上下文相关" aria-hidden="true" class="header-anchor">#</a> 2. 上下文相关</h3> <table><thead><tr><th>api</th> <th>简介</th></tr></thead> <tbody><tr><td>ctx.req</td> <td>Node 的 request 对象</td></tr> <tr><td>ctx.res</td> <td>Node 的 response 对象</td></tr> <tr><td>ctx.request</td> <td>Koa 的 Request 对象。</td></tr> <tr><td>ctx.response</td> <td>Koa 的 Response对象</td></tr> <tr><td>ctx.app</td> <td>应用实例引用。</td></tr> <tr><td>ctx.cookies.get(name, [options])</td> <td>获得 cookie 中名为 name 的值， options 为可选参数：'signed': 如果为 true， 表示请求时 cookie 需要进行签名,  注意：Koa 使用了 Express 的 cookies 模块，options 参数只是简单地直接进行传递</td></tr> <tr><td>ctx.cookies.set(name, value, [options])</td> <td>设置 cookie 中名为 name 的值， options 为可选参数： 1.signed: 是否要做签名; 2.expires: cookie 有效期时间; 3.path: cookie 的路径，默认为 /';domain: cookie 的域; 4.secure: false 表示 cookie 通过 HTTP 协议发送，true 表示 cookie 通过 HTTPS 发送。 5.httpOnly: true 表示 cookie 只能通过 HTTP 协议发送;  注意：Koa 使用了 Express 的 cookies 模块，options 参数只是简单地直接进行传递</td></tr> <tr><td>ctx.throw(msg, [status])</td> <td>抛出包含 <code>.status</code> 属性的错误，默认为 <code>500</code>。该方法可以让 Koa 准确的响应处理状态。 Koa支持以下组合：<code>this``.``throw``(403)``this``.``throw``(``'name required'``,400)``this``.``throw``(400,``'name required'``)``this``.``throw``(``'something exploded'``)</code>注意：这些用户级错误被标记为 <code>err.expose</code>，其意味着这些消息被准确描述为对客户端的响应，而并非使用在您不想泄露失败细节的场景中。</td></tr> <tr><td>ctx.respond</td> <td>为了避免使用 Koa 的内置响应处理功能，您可以直接赋值 this.repond = false;。如果您不想让 Koa 来帮助您处理 reponse，而是直接操作原生 res 对象，那么请使用这种方法。 注意： 这种方式是不被 Koa 支持的。其可能会破坏 Koa 中间件和 Koa 本身的一些功能。其只作为一种 hack 的方式，并只对那些想要在 Koa 方法和中间件中使用传统 fn(req, res) 方法的人来说会带来便利。</td></tr></tbody></table> <h3 id="_3-请求request"><a href="#_3-请求request" aria-hidden="true" class="header-anchor">#</a> 3. 请求request</h3> <p>Koa Request 对象是对 node 的 request 进一步抽象和封装，提供了日常 HTTP 服务器开发中一些有用的功能。</p> <table><thead><tr><th>api</th> <th>简介</th></tr></thead> <tbody><tr><td>req.header</td> <td>请求头对象</td></tr> <tr><td>req.method</td> <td>请求方法</td></tr> <tr><td>req.method=</td> <td>设置请求方法，在实现中间件时非常有用，比如 methodOverride()。</td></tr> <tr><td>req.length</td> <td>以数字的形式返回 request 的内容长度(Content-Length)，或者返回 <code>undefined</code>。</td></tr> <tr><td>req.url</td> <td>获得请求url地址。</td></tr> <tr><td>req.url=</td> <td>设置请求地址，用于重写url地址时。</td></tr> <tr><td>req.originalUrl</td> <td>获取请求原始地址。</td></tr> <tr><td>req.path</td> <td>获取请求路径名。</td></tr> <tr><td>req.path=</td> <td>设置请求路径名，并保留请求参数(就是url中?后面的部分)。</td></tr> <tr><td>req.querystring</td> <td>获取查询参数字符串(url中?后面的部分)，不包含 ?。</td></tr> <tr><td>req.querystring=</td> <td>设置查询参数。</td></tr> <tr><td>req.search</td> <td>获取查询参数字符串，包含 ?。</td></tr> <tr><td>req.search=</td> <td>设置查询参数字符串。</td></tr> <tr><td>req.host</td> <td>获取 host (hostname:port)。 当 app.proxy 设置为 true 时，支持 X-Forwarded-Host。</td></tr> <tr><td>req.hostname</td> <td>获取 hostname。当 app.proxy 设置为 true 时，支持 X-Forwarded-Host。</td></tr> <tr><td>req.type</td> <td>获取请求 Content-Type，不包含像 &quot;charset&quot; 这样的参数。 <code>var ct =this.request.type; // =&gt; &quot;image/png&quot;</code></td></tr> <tr><td>req.charset</td> <td>获取请求 charset，没有则返回 undefined:</td></tr> <tr><td>req.query</td> <td>将查询参数字符串进行解析并以对象的形式返回，如果没有查询参数字字符串则返回一个空对象。 注意：该方法不支持嵌套解析。 比如: <code>&quot;color=blue&amp;size=small&quot;``:``{``color:``'blue'``,``size:``'small'``}</code></td></tr> <tr><td>req.query=</td> <td>根据给定的对象设置查询参数字符串。 注意：该方法不支持嵌套对象。 <code>this``.query ={ next:``'/login'``};</code></td></tr> <tr><td>req.fresh</td> <td>检查请求缓存是否 &quot;fresh&quot;(内容没有发生变化)。该方法用于在 If-None-Match / ETag, If-Modified-Since 和 Last-Modified 中进行缓存协调。当在 response headers 中设置一个或多个上述参数后，该方法应该被使用。<code>this``.set(``'ETag'``,``'123'``);``// cache is ok``if``(``this``.fresh){``this``.status =304;``return``;``}``// cache is stale``// fetch new data``this``.body = ``yield</code> <code>db.find(``'something'``);</code></td></tr> <tr><td>req.stale</td> <td>与 req.fresh 相反。</td></tr> <tr><td>req.protocol</td> <td>返回请求协议，&quot;https&quot; 或者 &quot;http&quot;。 当 app.proxy 设置为 true 时，支持 X-Forwarded-Host</td></tr> <tr><td>req.ip</td> <td>请求远程地址。 当 app.proxy 设置为 true 时，支持 X-Forwarded-Host。</td></tr> <tr><td>req.secure</td> <td>简化版 this.protocol == &quot;https&quot;，用来检查请求是否通过 TLS 发送。</td></tr> <tr><td>req.ips</td> <td>当 X-Forwarded-For 存在并且 app.proxy 有效，将会返回一个有序（从 upstream 到 downstream）ip 数组。 否则返回一个空数组。</td></tr> <tr><td>req.subdomains</td> <td>以数组形式返回子域名。子域名是在host中逗号分隔的主域名前面的部分。默认情况下，应用的域名假设为host中最后两部分。其可通过设置 <code>app.subdomainOffset</code> 进行更改。举例来说，如果域名是 &quot;tobi.ferrets.example.com&quot;:如果没有设置 <code>app.subdomainOffset</code>，其 subdomains 为 <code>[&quot;ferrets&quot;, &quot;tobi&quot;]</code>。 如果设置 <code>app.subdomainOffset</code> 为3，其 subdomains 为 <code>[&quot;tobi&quot;]</code>。</td></tr> <tr><td>req.is(type)</td> <td>检查请求所包含的 &quot;Content-Type&quot; 是否为给定的 type 值。 如果没有 request body，返回 undefined。 如果没有 content type，或者匹配失败，返回 false。 否则返回匹配的 content-type。<code>// With Content-Type: text/html; charset=utf-8``this``.is(``'html'``);``// =&gt; 'html'``this``.is(``'text/html'``);``// =&gt; 'text/html'``this``.is(``'text/*'``,``'text/html'``);``// =&gt; 'text/html'``// When Content-Type is application/json``this``.is(``'json'``,``'urlencoded'``);``// =&gt; 'json'``this``.is(``'application/json'``);``// =&gt; 'application/json'``this``.is(``'html'``,``'application/*'``);``// =&gt; 'application/json'``this``.is(``'html'``);``// =&gt; false``//比如说您希望保证只有图片发送给指定路由：``if``(``this``.is(``'image/*'``)){``// process``}``else``{``this``.``throw``(415,``'images only!'``);``}</code></td></tr> <tr><td>Content Negotiation</td> <td>Koa request 对象包含 content negotiation 功能（由 accepts 和 negotiator 提供）： <code>req.accepts(types)``req.acceptsEncodings(types)``req.acceptsCharsets(charsets)``req.acceptsLanguages(langs)</code>如果没有提供 types，将会返回所有的可接受类型。 如果提供多种 types，将会返回最佳匹配类型。如果没有匹配上，则返回 false，您应该给客户端返回 406 &quot;Not Acceptable&quot;。 为了防止缺少 accept headers 而导致可以接受任意类型，将会返回第一种类型。因此，您提供的类型顺序非常重要。</td></tr> <tr><td>req.accepts(types)</td> <td>检查给定的类型 <code>types(s)</code> 是否可被接受，当为 true 时返回最佳匹配，否则返回 <code>false</code>。<code>type</code> 的值可以是一个或者多个 mime 类型字符串。 比如 &quot;application/json&quot; 扩展名为 &quot;json&quot;，或者数组 <code>[&quot;json&quot;, &quot;html&quot;, &quot;text/plain&quot;]</code>。<code>// Accept: text/html``this``.accepts(``'html'``);``// =&gt; &quot;html&quot;``// Accept: text/*, application/json``this``.accepts(``'html'``);``// =&gt; &quot;html&quot;``this``.accepts(``'text/html'``);``// =&gt; &quot;text/html&quot;``this``.accepts(``'json'``,``'text'``);``// =&gt; &quot;json&quot;``this``.accepts(``'application/json'``);``// =&gt; &quot;application/json&quot;``// Accept: text/*, application/json``this``.accepts(``'image/png'``);``this``.accepts(``'png'``);``// =&gt; false``// Accept: text/*;q=.5, application/json``this``.accepts([``'html'``,``'json'``]);``this``.accepts(``'html'``,``'json'``);``// =&gt; &quot;json&quot;``// No Accept header``this``.accepts(``'html'``,``'json'``);``// =&gt; &quot;html&quot;``this``.accepts(``'json'``,``'html'``);``// =&gt; &quot;json&quot;</code></td></tr> <tr><td>req.acceptsEncodings(encodings)</td> <td>检查 encodings 是否可以被接受，当为 true 时返回最佳匹配，否则返回 false。 注意：您应该在 encodings 中包含 identity。 <code>// Accept-Encoding: gzip``this``.acceptsEncodings(``'gzip'``,``'deflate'``,``'identity'``);``// =&gt; &quot;gzip&quot;``this``.acceptsEncodings([``'gzip'``,``'deflate'``,``'identity'``]);``// =&gt; &quot;gzip&quot;</code>当没有传递参数时，返回包含所有可接受的 encodings 的数组：<code>// Accept-Encoding: gzip, deflate``this``.acceptsEncodings();``// =&gt; [&quot;gzip&quot;, &quot;deflate&quot;, &quot;identity&quot;]</code>注意：如果客户端直接发送 <code>identity;q=0</code> 时，<code>identity</code> encoding（表示no encoding） 可以不被接受。虽然这是一个边界情况，您仍然应该处理这种情况。</td></tr> <tr><td>req.acceptsCharsets(charsets)</td> <td>检查 charsets 是否可以被接受，如果为 true 则返回最佳匹配， 否则返回 false。 <code>// Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5``this``.acceptsCharsets(``'utf-8'``,``'utf-7'``);``// =&gt; &quot;utf-8&quot;``this``.acceptsCharsets([``'utf-7'``,``'utf-8'``]);``// =&gt; &quot;utf-8&quot;</code>当没有传递参数时， 返回包含所有可接受的 charsets 的数组：<code>// Accept-Charset: utf-8, iso-8859-1;q=0.2, utf-7;q=0.5 this.acceptsCharsets(); // =&gt; [&quot;utf-8&quot;, &quot;utf-7&quot;, &quot;iso-8859-1&quot;]</code></td></tr> <tr><td>req.acceptsLanguages(langs)</td> <td>检查 langs 是否可以被接受，如果为 true 则返回最佳匹配，否则返回 false。 <code>// Accept-Language: en;q=0.8, es, pt``this``.acceptsLanguages(``'es'``,``'en'``);``// =&gt; &quot;es&quot;``this``.acceptsLanguages([``'en'``,``'es'``]);``// =&gt; &quot;es&quot;</code>当没有传递参数时，返回包含所有可接受的 langs 的数组：<code>// Accept-Language: en;q=0.8, es, pt``this``.acceptsLanguages();``// =&gt; [&quot;es&quot;, &quot;pt&quot;, &quot;en&quot;]</code></td></tr> <tr><td>req.idempotent</td> <td>检查请求是否为幂等(idempotent)。</td></tr> <tr><td>req.socket</td> <td>返回请求的socket。</td></tr> <tr><td>req.get(field)</td> <td>返回请求 header 中对应 field 的值。</td></tr></tbody></table> <h3 id="_4-响应-response"><a href="#_4-响应-response" aria-hidden="true" class="header-anchor">#</a> 4. 响应(Response)</h3> <p>Koa Response 对象是对 node 的 response 进一步抽象和封装，提供了日常 HTTP 服务器开发中一些有用的功能。</p> <table><thead><tr><th>API</th> <th>简介</th></tr></thead> <tbody><tr><td>res.header</td> <td>Response header 对象。</td></tr> <tr><td>res.socket</td> <td>Request socket。</td></tr> <tr><td>res.status</td> <td>获取 response status。不同于 node 在默认情况下 res.statusCode 为200，res.status 并没有赋值。</td></tr> <tr><td>res.statusString</td> <td>Response status 字符串。</td></tr> <tr><td>res.status=</td> <td>通过 数字状态码或者不区分大小写的字符串来设置response status<code>100``&quot;continue&quot;``101``&quot;switching protocols&quot;``102``&quot;processing&quot;``200``&quot;ok&quot;``201``&quot;created&quot;``202``&quot;accepted&quot;``203``&quot;non-authoritative information&quot;``204``&quot;no content&quot;``205``&quot;reset content&quot;``206``&quot;partial content&quot;``207``&quot;multi-status&quot;``300``&quot;multiple choices&quot;``301``&quot;moved permanently&quot;``302``&quot;moved temporarily&quot;``303``&quot;see other&quot;``304``&quot;not modified&quot;``305``&quot;use proxy&quot;``307``&quot;temporary redirect&quot;``400``&quot;bad request&quot;``401``&quot;unauthorized&quot;``402``&quot;payment required&quot;``403``&quot;forbidden&quot;``404``&quot;not found&quot;``405``&quot;method not allowed&quot;``406``&quot;not acceptable&quot;``407``&quot;proxy authentication required&quot;``408``&quot;request time-out&quot;``409``&quot;conflict&quot;``410``&quot;gone&quot;``411``&quot;length required&quot;``412``&quot;precondition failed&quot;``413``&quot;request entity too large&quot;``414``&quot;request-uri too large&quot;``415``&quot;unsupported media type&quot;``416``&quot;requested range not satisfiable&quot;``417``&quot;expectation failed&quot;``418``&quot;i'm a teapot&quot;``422``&quot;unprocessable entity&quot;``423``&quot;locked&quot;``424``&quot;failed dependency&quot;``425``&quot;unordered collection&quot;``426``&quot;upgrade required&quot;``428``&quot;precondition required&quot;``429``&quot;too many requests&quot;``431``&quot;request header fields too large&quot;``500``&quot;internal server error&quot;``501``&quot;not implemented&quot;``502``&quot;bad gateway&quot;``503``&quot;service unavailable&quot;``504``&quot;gateway time-out&quot;``505``&quot;http version not supported&quot;``506``&quot;variant also negotiates&quot;``507``&quot;insufficient storage&quot;``509``&quot;bandwidth limit exceeded&quot;``510``&quot;not extended&quot;``511``&quot;network authentication required&quot;``注意：不用担心记不住这些字符串，如果您设置错误，会有异常抛出，并列出该状态码表来帮助您进行更正。</code></td></tr> <tr><td>res.length=</td> <td>通过给定值设置 response Content-Length。</td></tr> <tr><td>res.length</td> <td>如果 Content-Length 作为数值存在，或者可以通过 res.body 来进行计算，则返回相应数值，否则返回 undefined。</td></tr> <tr><td>res.body</td> <td>获得 response body。</td></tr> <tr><td>res.body=</td> <td>设置 response body 为如下值： <code>string written``Buffer written``Stream piped``Object json-stringified``null</code> <code>no content response</code>如果 res.status 没有赋值，Koa会自动设置为 200 或 204。</td></tr> <tr><td>String</td> <td>Content-Type 默认为 text/html 或者 text/plain，两种默认 charset 均为 utf-8。 Content-Length 同时会被设置。</td></tr> <tr><td>Buffer</td> <td>Content-Type 默认为 application/octet-stream，Content-Length同时被设置。</td></tr> <tr><td>Stream</td> <td>Content-Type 默认为 application/octet-stream。</td></tr> <tr><td>Object</td> <td>Content-Type 默认为 application/json。</td></tr> <tr><td>res.get(field)</td> <td>获取 response header 中字段值，field 不区分大小写。<code>var</code> <code>etag =``this``.get(``'ETag'``);</code></td></tr> <tr><td>res.set(field, value)</td> <td>设置 response header 字段 field 的值为 value。<code>this``.set(``'Cache-Control'``,``'no-cache'``);</code></td></tr> <tr><td>res.set(fields)</td> <td>使用对象同时设置 response header 中多个字段的值。<code>this``.set({``'Etag'``:``'1234'``,``'Last-Modified'``: date``});</code></td></tr> <tr><td>res.remove(field)</td> <td>移除 response header 中字段 filed。</td></tr> <tr><td>res.type</td> <td>获取 response <code>Content-Type</code>，不包含像 &quot;charset&quot; 这样的参数。 <code>var</code> <code>ct =``this``.type;``// =&gt; &quot;image/png&quot;</code></td></tr> <tr><td>res.type=</td> <td>通过 mime 类型的字符串或者文件扩展名设置 response Content-Type <code>this``.type =``'text/plain; charset=utf-8'``;``this``.type =``'image/png'``;``this``.type =``'.png'``;``this``.type =``'png'``;</code> 注意：当可以根据 res.type 确定一个合适的 charset 时，charset 会自动被赋值。 比如 res.type = 'html' 时，charset 将会默认设置为 &quot;utf-8&quot;。然而当完整定义为 res.type = 'text/html'时，charset 不会自动设置。</td></tr> <tr><td>res.redirect(url, [alt])</td> <td>执行 [302] 重定向到对应 url。 字符串 &quot;back&quot; 是一个特殊参数，其提供了 Referrer 支持。当没有Referrer时，使用 alt 或者 / 代替。 <code>this``.redirect(``'back'``);``this``.redirect(``'back'``,``'/index.html'``);``this``.redirect(``'/login'``);``this``.redirect(``'http://google.com'``);</code>如果想要修改默认的 [302] 状态，直接在重定向之前或者之后执行即可。如果要修改 body，需要在重定向之前执行。 <code>this``.status =301;``this``.redirect(``'/cart'``);``this``.body =``'Redirecting to shopping cart'``;</code></td></tr> <tr><td>res.attachment([filename])</td> <td>设置 &quot;attachment&quot; 的 Content-Disposition，用于给客户端发送信号来提示下载。filename 为可选参数，用于指定下载文件名。</td></tr> <tr><td>res.headerSent</td> <td>检查 response header 是否已经发送，用于在发生错误时检查客户端是否被通知。</td></tr> <tr><td>res.lastModified</td> <td>如果存在 Last-Modified，则以 Date 的形式返回。</td></tr> <tr><td>res.lastModified=</td> <td>以 UTC 格式设置 <code>Last-Modified</code>。您可以使用 <code>Date</code> 或 date 字符串来进行设置。<code>this``.response.lastModified =newDate()</code></td></tr> <tr><td>res.etag=</td> <td>设置 包含 &quot;s 的 ETag。注意没有对应的 res.etag 来获取其值。<code>this``.response.etag = crypto.createHash(``'md5'``).update(``this``.body).digest(``'hex'``);</code></td></tr> <tr><td>res.append(field, val)</td> <td>在 header 的 field 后面 追加 val。</td></tr> <tr><td>res.vary(field)</td> <td>相当于执行res.append('Vary', field)。</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">6/25/2020, 4:17:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/koa/001-koa-src-code/003-error-handle/" class="prev">
          003-Koa源码解读：错误处理
        </a></span> <span class="next"><a href="/koa/006-koa-reflect-metadata/">
          006 - Reflect Metadata 简单入门
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.83679c7a.js" defer></script><script src="/assets/js/2.60600da5.js" defer></script><script src="/assets/js/76.5eac82cb.js" defer></script><script src="/assets/js/8.e132ed9d.js" defer></script>
  </body>
</html>
