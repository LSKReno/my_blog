(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{302:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_003-前端跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_003-前端跨域问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 003:前端跨域问题")]),t._v(" "),a("p",[a("motto")],1),t._v(" "),a("h2",{attrs:{id:"_1-为什么会出现跨域问题？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么会出现跨域问题？","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 为什么会出现跨域问题？")]),t._v(" "),a("p",[t._v("跨域问题的出现，主要是因为同源策略（same origin policy）。")]),t._v(" "),a("p",[t._v("同源策略会阻止一个域下的JS脚本不可以和另一个域下的内容进行交互，所以就出现了跨域问题。")]),t._v(" "),a("p",[t._v("同源策略是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说Web是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。")]),t._v(" "),a("h2",{attrs:{id:"_2-同源策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-同源策略","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 同源策略")]),t._v(" "),a("h3",{attrs:{id:"什么是源？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是源？","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是源？")]),t._v(" "),a("p",[a("code",[t._v("源 = 协议 + 域名 + 端口号")])]),t._v(" "),a("p",[t._v("如果两个"),a("code",[t._v("url")]),t._v("的协议、域名、端口号完全一致，那么这两个"),a("code",[t._v("url")]),t._v("就是"),a("code",[t._v("同源")]),t._v("的。")]),t._v(" "),a("p",[t._v("我们可以通过"),a("code",[t._v("window.origin")]),t._v("或"),a("code",[t._v("location.origin")]),t._v("得到当前源。")]),t._v(" "),a("h3",{attrs:{id:"什么是同源策略？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是同源策略？","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是同源策略？")]),t._v(" "),a("p",[a("strong",[t._v("同源策略即")]),t._v("：不同源之间的页面，不可以互相访问数据。")]),t._v(" "),a("h3",{attrs:{id:"为什么会有同源策略？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么会有同源策略？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么会有同源策略？")]),t._v(" "),a("p",[t._v("那你可能想问了，跨域是由同源策略导致的，那么为什么要有同源策略呢？")]),t._v(" "),a("p",[t._v("之所以需要使用同源策略，就是"),a("code",[t._v("为了保护用户的隐私")]),t._v("。")]),t._v(" "),a("p",[t._v("以微信为例，源为 "),a("code",[t._v("https://user.weixin.com")]),t._v("，假设当前用户已经登录，并且"),a("code",[t._v("AJAX")]),t._v("请求 "),a("code",[t._v("/userinfo.json")]),t._v(" 可以获取用户信息。")]),t._v(" "),a("p",[t._v("这个时候黑客来了，他把 "),a("code",[t._v("https://user-winxin.com")]),t._v("分享给你，实际上这是一个钓鱼网站，你点开这个网页，这个网页也请求你的用户信息"),a("code",[t._v("https://user.weixin.com/userinfo.json。")])]),t._v(" "),a("p",[t._v("请问，这个时候你的用户信息是不是就被黑客给偷走了？")]),t._v(" "),a("h3",{attrs:{id:"问题的根源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题的根源","aria-hidden":"true"}},[t._v("#")]),t._v(" 问题的根源")]),t._v(" "),a("p",[t._v("之所以会出现这个问题，其根源就在于"),a("strong",[t._v("无法区分发送者")]),t._v("。")]),t._v(" "),a("p",[t._v("微信里面的"),a("code",[t._v("JS")]),t._v("和黑客的"),a("code",[t._v("JS")]),t._v("发送到请求几乎没有区别（"),a("code",[t._v("referer")]),t._v("区别）")]),t._v(" "),a("p",[t._v("但是如果后台的开发者没有检查 "),a("code",[t._v("referer")]),t._v("，那么就完全没有区别。")]),t._v(" "),a("p",[t._v("所以，如果没有同源策略，任何页面都能偷走微信里面的数据，甚至是支付宝里面的余额。")]),t._v(" "),a("h3",{attrs:{id:"安全原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全原则","aria-hidden":"true"}},[t._v("#")]),t._v(" 安全原则")]),t._v(" "),a("p",[t._v("有的小伙伴可能会问，既然"),a("code",[t._v("referer")]),t._v("有区别，那检查"),a("code",[t._v("referer")]),t._v("不就好了？")]),t._v(" "),a("p",[a("strong",[t._v("安全原则")]),t._v("：安全链条上的强度取决于安全链条上最弱的一环。")]),t._v(" "),a("p",[t._v("同时，万一这个网站的后端开发者是一个傻叉呢？")]),t._v(" "),a("p",[t._v("所以浏览器应该主动预防这种偷数据的行为。")]),t._v(" "),a("p",[t._v("总之，为了保护用户的隐私，浏览器设置了严格的同源策略。")]),t._v(" "),a("p",[t._v("如果浏览器不限制跨域，一定是这个浏览器出现了"),a("code",[t._v("bug")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_3-什么是跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-什么是跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 什么是跨域")]),t._v(" "),a("h3",{attrs:{id:"跨域概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域概念")]),t._v(" "),a("p",[t._v("跨域，即浏览器试图执行其他网站的脚本。但是由于同源策略的限制，导致我们无法实现跨域。")]),t._v(" "),a("p",[t._v("当一个请求url的协议、域名(包括主域名、子域名)、端口三者之间任意一个与当前页面url不同即为跨域。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("当前页面url")]),t._v(" "),a("th",[t._v("被请求页面url")]),t._v(" "),a("th",[t._v("是否跨域")]),t._v(" "),a("th",[t._v("原因")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("http://www.baitang.com/")]),t._v(" "),a("td",[t._v("http://www.baitang.com/index.html")]),t._v(" "),a("td",[t._v("否")]),t._v(" "),a("td",[t._v("同源")])]),t._v(" "),a("tr",[a("td",[t._v("http://www.baitang.com/")]),t._v(" "),a("td",[t._v("https://www.baitang.com/index.html")]),t._v(" "),a("td",[t._v("跨域")]),t._v(" "),a("td",[t._v("协议不同（http/https")])]),t._v(" "),a("tr",[a("td",[t._v("http://www.baitang.com/")]),t._v(" "),a("td",[t._v("http://www.baidu.com/")]),t._v(" "),a("td",[t._v("跨域")]),t._v(" "),a("td",[t._v("主域名不同（baitang/baidu")])]),t._v(" "),a("tr",[a("td",[t._v("http://www.baitang.com/")]),t._v(" "),a("td",[t._v("http://blog.baitang.com")]),t._v(" "),a("td",[t._v("跨域")]),t._v(" "),a("td",[t._v("子域名不同（www/blog")])]),t._v(" "),a("tr",[a("td",[t._v("http://www.baitang.com:8080/")]),t._v(" "),a("td",[t._v("http://www.baitang.com:7001")]),t._v(" "),a("td",[t._v("跨域")]),t._v(" "),a("td",[t._v("端口号不同")])])])]),t._v(" "),a("h3",{attrs:{id:"为什么www-baitang-com访问blog-baitang-com也算跨域？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么www-baitang-com访问blog-baitang-com也算跨域？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么"),a("code",[t._v("www.baitang.com")]),t._v("访问"),a("code",[t._v("blog.baitang.com")]),t._v("也算跨域？")]),t._v(" "),a("p",[t._v("因为历史上，出现过"),a("strong",[t._v("不同的公司共用域名")]),t._v("，"),a("code",[t._v("www.baitang.com")]),t._v("和"),a("code",[t._v("blog.baitang.com")]),t._v("不一定是同一个网站，浏览器谨慎起见，认为这是不同的源。")]),t._v(" "),a("h3",{attrs:{id:"为什么不同端口也算跨域？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么不同端口也算跨域？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么不同端口也算跨域？")]),t._v(" "),a("p",[t._v("原因同上，一个端口一个公司的情况也不是没有的。")]),t._v(" "),a("p",[a("strong",[t._v("记住")]),t._v("：安全链条的强度取决于最弱的一环，所有和安全相关的问题都要谨慎对待。")]),t._v(" "),a("h3",{attrs:{id:"为什么两个网站的ip一样，也算跨域？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么两个网站的ip一样，也算跨域？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么两个网站的"),a("code",[t._v("IP")]),t._v("一样，也算跨域？")]),t._v(" "),a("p",[t._v("原因同上，因为"),a("code",[t._v("IP")]),t._v("也是可以共用的。")]),t._v(" "),a("h3",{attrs:{id:"为什么可以跨域使用css、js和图片等？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么可以跨域使用css、js和图片等？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么可以跨域使用"),a("code",[t._v("CSS")]),t._v("、"),a("code",[t._v("JS")]),t._v("和图片等？")]),t._v(" "),a("p",[t._v("同源策略限制的是"),a("code",[t._v("数据访问")]),t._v("，我们引用"),a("code",[t._v("CSS")]),t._v("、"),a("code",[t._v("JS")]),t._v("和图片的时候，其实并不知道其内容，我们只是在引用。")]),t._v(" "),a("h3",{attrs:{id:"为什么同源是浏览器行为的疑问？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么同源是浏览器行为的疑问？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么同源是浏览器行为的疑问？")]),t._v(" "),a("p",[t._v("你在看到同源策略是浏览器行为的时候可能会有疑问：")]),t._v(" "),a("p",[t._v("同源限制既然是浏览器行为，为什么服务端设置CORS之后，浏览器就能发出跨域请求了，如果是同源策略是浏览器行为的话，理论上浏览器应该是发不出跨域请求，那么服务器如何根据Origin的值来判断是否接受本次请求呢？")]),t._v(" "),a("p",[a("strong",[t._v("解答：")])]),t._v(" "),a("p",[t._v("同源策略是浏览器行为，实际上跨域请求是能发送的，服务器也能正常接收，数据也能正常返回，只是浏览器把你跨域请求的响应数据给屏蔽了而已。")]),t._v(" "),a("h2",{attrs:{id:"_4、跨域解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、跨域解决方法","aria-hidden":"true"}},[t._v("#")]),t._v(" 4、跨域解决方法")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("设置document.domain解决无法读取非同源网页的 Cookie问题")])]),t._v(" "),a("li",[a("p",[t._v("跨文档通信 API：window.postMessage()")])]),t._v(" "),a("li",[a("p",[t._v("JSONP")])]),t._v(" "),a("li",[a("p",[t._v("CORS")])]),t._v(" "),a("li",[a("p",[t._v("Proxy")])])]),t._v(" "),a("p",[t._v("作为开发人员，最关心的跨域一般是2种交互的跨域，即"),a("code",[t._v("Proxy")]),t._v("和"),a("code",[t._v("CORS")]),t._v("，很多开发只图一时方便，使用了Proxy，在打包后就发现又有跨域了，不知道怎么解决，下面我们通过实例一点点给大家解析。")]),t._v(" "),a("h3",{attrs:{id:"跨域解决之proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域解决之proxy","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域解决之Proxy")]),t._v(" "),a("p",[t._v("现在项目一般都使用脚手架，即使用webpack，那可以使用webpack自带的proxy特性来处理跨域。")]),t._v(" "),a("p",[t._v("这种方式是开发最常用的，但是打包后就有问题了，因为打包后就不存在proxy了，跨域还是会存在，那应该怎么解决？")]),t._v(" "),a("h3",{attrs:{id:"跨域解决之cors-跨域资源共享cross-origin-resource-sharing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域解决之cors-跨域资源共享cross-origin-resource-sharing","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域解决之CORS(跨域资源共享Cross-Origin Resource Sharing)")]),t._v(" "),a("p",[t._v("实现"),a("code",[t._v("CORS")]),t._v("通信的关键是服务器。只要服务器配置了"),a("code",[t._v("CORS")]),t._v("接口，前端无需任何处理，就可以跨域通信，无论是"),a("strong",[t._v("在开发时还是部署时都是OK")]),t._v("的。")]),t._v(" "),a("p",[t._v("下面，我们把proxy注释掉，使用CORS方式处理，如下：")]),t._v(" "),a("p",[a("strong",[t._v("设置允许所有域名跨域：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置允许跨域的域名，*代表允许任意域名跨域")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的header类型")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content-type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//跨域允许的请求方式 ")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE,PUT,POST,GET,OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让options尝试请求快速结束")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("设置允许指定域名“http://www.baitang.com”跨域：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置允许跨域的域名，*代表允许任意域名跨域")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.baitang.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的header类型")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content-type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//跨域允许的请求方式 ")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE,PUT,POST,GET,OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让options尝试请求快速结束")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("设置允许多个域名跨域：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.baitang.com"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置允许跨域的域名，*代表允许任意域名跨域")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的header类型")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content-type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//跨域允许的请求方式 ")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE,PUT,POST,GET,OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让options尝试请求快速结束")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("如果允许的域名较多，可以将允许跨域的域名放到数组当中：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" orginList"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.baitang.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.alibaba.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.qq.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.baidu.com"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orginList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置允许跨域的域名，*代表允许任意域名跨域")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//允许的header类型")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"content-type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//跨域允许的请求方式")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE,PUT,POST,GET,OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让options尝试请求快速结束")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("配置了cors后，接口就可以随便访问了。")]),t._v(" "),a("h4",{attrs:{id:"简单请求-复杂请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求-复杂请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 简单请求&复杂请求")]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v("跨域分为两种请求，一种是"),a("strong",[t._v("简单请求")]),t._v("，另外一种就是"),a("strong",[t._v("复杂请求")]),t._v("。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("简单请求：\n1): 请求方式只能是："),a("code",[t._v("head")]),t._v("，"),a("code",[t._v("get")]),t._v("，"),a("code",[t._v("post")]),t._v("\n2): 请求头允许的字段："),a("code",[t._v("Accept")]),t._v("，"),a("code",[t._v("Accept-Language")]),t._v("，"),a("code",[t._v("Content-Language")]),t._v("，"),a("code",[t._v("Last-Event-ID")]),t._v(" "),a("code",[t._v("Content-Type")]),t._v("：application/x-www-form-urlencoded、multipart/form-data、text/plain  三选一")])]),t._v(" "),a("li",[a("p",[t._v("复杂请求：不满足上面的，都是我啦！")])])]),t._v(" "),a("h5",{attrs:{id:"简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),a("p",[t._v("简单请求的实现具体来说就是在信息头中加入一个"),a("code",[t._v("Origin")]),t._v("字段：")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token request-line"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("GET")]),t._v(" /cors HTTP/1.1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Origin:")]),t._v(" http://blog.baitang.com \n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Host:")]),t._v(" api.baitang.com\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Accept-Language:")]),t._v(" en-US\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection:")]),t._v(" keep-alive\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("User-Agent:")]),t._v(" Mozilla/5.0\n...\n")])])]),a("p",[t._v("浏览器：你小子要跨域是吧，我得问问服务器大哥肯不肯！往请求头添加"),a("code",[t._v("origin")]),t._v("亮一下牌面")]),t._v(" "),a("p",[t._v("服务器：诶，你是谁，我来看看你的origin，嗯嗯，可以，符合我的要求，放行！顺便告诉你，老夫的规矩！")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Access-Control-Allow-Origin`，标识允许哪个域的请求。\n当然，如果服务器不通过，根本没有这个字段，接着触发`XHR`的`onerror`，再接着你就看到浏览器的提示`xxx的服务器没有响应Access-Control-Allow-Origin字段\n")])])]),a("p",[a("code",[t._v("Origin")]),t._v("的作用就是用来说明本次请求来自哪个源，服务器会根据"),a("code",[t._v("Origin")]),t._v("的值来判断是否接受本次请求。")]),t._v(" "),a("p",[t._v("如果"),a("code",[t._v("Origin")]),t._v("所表示的源不被服务器接受，即浏览器发现回应的信息头中没有"),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段，就会自动抛出一个错误。")]),t._v(" "),a("p",[t._v("注意：这种错误是无法通过状态码识别的，这也是通过"),a("code",[t._v("CORS")]),t._v("实现跨域请求的一个弊端。")]),t._v(" "),a("p",[t._v("如果"),a("code",[t._v("Origin")]),t._v("所表示的源被服务器端所接受，那么服务器就会返回如下响应：")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Origin:")]),t._v(" http://api.baitang.com\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Credentials:")]),t._v(" true\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Expose-Headers:")]),t._v(" baitang\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type:")]),t._v(" text/html; charset=utf-8\n")])])]),a("p",[a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" :该字段是必须的。它的值要么是请求时"),a("code",[t._v("Origin")]),t._v("字段的值，要么是一个"),a("code",[t._v("*")]),t._v("，表示接受任意域名的请求")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Allow-Credentials")]),t._v(": 该字段可选。它的值是一个布尔值，表示是否允许发送"),a("code",[t._v("Cookie")]),t._v("。默认情况下，"),a("code",[t._v("Cookie")]),t._v("不包括在"),a("code",[t._v("CORS")]),t._v("请求之中。设为"),a("code",[t._v("true")]),t._v("，即表示服务器明确许可，"),a("code",[t._v("Cookie")]),t._v("可以包含在请求中，一起发给服务器。这个值也"),a("strong",[t._v("只能设为"),a("code",[t._v("true")])]),t._v("，如果服务器不要浏览器发送"),a("code",[t._v("Cookie")]),t._v("，删除该字段即可。(注意：如果要发送"),a("code",[t._v("cookie")]),t._v("，不仅要进行上述的设置，还要在"),a("code",[t._v("AJAX")]),t._v("请求中设置"),a("code",[t._v("withCredentials")]),t._v("属性）")]),t._v(" "),a("p",[a("code",[t._v("Access-Control-Expose-Headers")]),t._v(":该字段可选。"),a("code",[t._v("CORS")]),t._v("请求时，"),a("code",[t._v("XMLHttpRequest")]),t._v("对象的"),a("code",[t._v("getResponseHeader()")]),t._v("方法只能拿到6个基本字段："),a("code",[t._v("Cache-Control")]),t._v("、"),a("code",[t._v("Content-Language")]),t._v("、"),a("code",[t._v("Content-Type")]),t._v("、"),a("code",[t._v("Expires")]),t._v("、"),a("code",[t._v("Last-Modified")]),t._v("、"),a("code",[t._v("Pragma")]),t._v("。如果想拿到其他字段，就必须在"),a("code",[t._v("Access-Control-Expose-Headers")]),t._v("里面指定")]),t._v(" "),a("h5",{attrs:{id:"复杂请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复杂请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 复杂请求:")]),t._v(" "),a("p",[t._v("最常见的情况，当我们使用"),a("code",[t._v("put")]),t._v("和"),a("code",[t._v("delete")]),t._v("请求时，浏览器会先发送"),a("code",[t._v("option")]),t._v("（预检）请求，不过有时候，你会发现并没有，这是后面我们会讲到缓存。")]),t._v(" "),a("p",[a("strong",[t._v("预检请求")])]),t._v(" "),a("p",[t._v("与简单请求不同的是，option请求多了2个字段：\n"),a("code",[t._v("Access-Control-Request-Method")]),t._v("：该次请求的请求方式\n"),a("code",[t._v("Access-Control-Request-Headers")]),t._v("：该次请求的自定义请求头字段")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://api.wang.com/cors'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PUT'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Custom-Header'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("服务器检查通过后，做出响应：")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("//指定允许其他域名访问\n'Access-Control-Allow-Origin:http://172.20.0.206'//一般用法（*，指定域，动态设置），3是因为*不允许携带认证头和cookies\n//是否允许后续请求携带认证信息（cookies）,该值只能是true,否则不返回\n'Access-Control-Allow-Credentials:true'\n//预检结果缓存时间,也就是上面说到的缓存啦\n'Access-Control-Max-Age: 1800'\n//允许的请求类型\n'Access-Control-Allow-Methods:GET,POST,PUT,POST'\n//允许的请求头字段\n'Access-Control-Allow-Headers:x-requested-with,content-type'\n")])])]),a("p",[t._v("这里有个注意点："),a("code",[t._v("Access-Control-Request-Method")]),t._v("，"),a("code",[t._v("Access-Control-Request-Headers")]),t._v("返回的是满足服务器要求的所有请求方式，请求头，不限于该次请求。")]),t._v(" "),a("p",[t._v("服务器收到预检请求之后，检查了"),a("code",[t._v("Origin")]),t._v("、"),a("code",[t._v("Access-Control-Request-Method")]),t._v("和"),a("code",[t._v("Access-Control-Request-Headers")]),t._v("字段以后，确认允许跨源请求，才会做出相应的回应。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Origin:")]),t._v(" http://api.wang.com\n"),a("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Content-Type:")]),t._v(" text/html; charset=utf-8\n")])])]),a("h4",{attrs:{id:"cors存在的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors存在的问题","aria-hidden":"true"}},[t._v("#")]),t._v(" CORS存在的问题")]),t._v(" "),a("p",[t._v("不支持"),a("code",[t._v("IE8/9")]),t._v("，如果要在"),a("code",[t._v("IE8/9")]),t._v("使用"),a("code",[t._v("CORS")]),t._v("跨域需要使用"),a("code",[t._v("XDomainRequest")]),t._v("对象来支持"),a("code",[t._v("CORS")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"跨域解决之proxy-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域解决之proxy-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域解决之Proxy")]),t._v(" "),a("h4",{attrs:{id:"什么是jsonp？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是jsonp？","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是JSONP？")]),t._v(" "),a("p",[t._v("我们在跨域的时候由于当前的浏览器不支持 "),a("code",[t._v("CORS")]),t._v(" 或者因为某些条件不支持 "),a("code",[t._v("CORS")]),t._v("，我们必须使用另外一种方式来跨域，于是我们就请求一个 "),a("code",[t._v("JS")]),t._v(" 文件，这个 "),a("code",[t._v("JS")]),t._v(" 文件会执行一个回调，回调里面就有我们需要的数据。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.test.cn/login?username=user1&callback=callback'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"回调函数的名字是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回调函数的名字是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 回调函数的名字是什么？")]),t._v(" "),a("p",[t._v("回调的名字是可以随机生成的的一个随机数，我们把这个名字当成 "),a("code",[t._v("callback")]),t._v(" 的参数传给后台，后台会把这个函数再次返回给我们并执行")]),t._v(" "),a("h4",{attrs:{id:"jsonp跨域优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp跨域优点","aria-hidden":"true"}},[t._v("#")]),t._v(" JSONP跨域优点")]),t._v(" "),a("ul",[a("li",[t._v("兼容"),a("code",[t._v("ie")])]),t._v(" "),a("li",[t._v("可以跨域")])]),t._v(" "),a("h4",{attrs:{id:"jsonp跨域缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp跨域缺点","aria-hidden":"true"}},[t._v("#")]),t._v(" JSONP跨域缺点")]),t._v(" "),a("ul",[a("li",[t._v("由于是 "),a("code",[t._v("script")]),t._v(" 标签，所以读不到 "),a("code",[t._v("ajax")]),t._v(" 那么精确的状态，不知道状态码是什么，也不知道响应头是什么，它只知道成功和失败。")]),t._v(" "),a("li",[t._v("不支持"),a("code",[t._v("post")]),t._v("（因为是 "),a("code",[t._v("script")]),t._v(" 标签，所以只支持 "),a("code",[t._v("get")]),t._v(" 请求）")])])])}),[],!1,null,null,null);s.default=e.exports}}]);