(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{352:function(t,_,v){"use strict";v.r(_);var e=v(2),o=Object(e.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"_007-说说-tcp-快速打开的原理-tfo"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_007-说说-tcp-快速打开的原理-tfo","aria-hidden":"true"}},[t._v("#")]),t._v(" 007-说说 TCP 快速打开的原理(TFO)")]),t._v(" "),v("p",[t._v("第一节讲了 TCP 三次握手，可能有人会说，每次都三次握手好麻烦呀！能不能优化一点？")]),t._v(" "),v("p",[t._v("可以啊。今天来说说这个优化后的 TCP 握手流程，也就是 TCP 快速打开("),v("strong",[t._v("TCP Fast Open")]),t._v(", 即"),v("strong",[t._v("TFO")]),t._v(")的原理。")]),t._v(" "),v("p",[t._v("优化的过程是这样的，还记得我们说 SYN Flood 攻击时提到的 SYN Cookie 吗？"),v("strong",[t._v("这个 Cookie 可不是浏览器的Cookie, 用它同样可以实现 TFO。")])]),t._v(" "),v("h3",{attrs:{id:"tfo-流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#tfo-流程","aria-hidden":"true"}},[t._v("#")]),t._v(" TFO 流程")]),t._v(" "),v("h3",{attrs:{id:"首轮三次握手"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#首轮三次握手","aria-hidden":"true"}},[t._v("#")]),t._v(" 首轮三次握手")]),t._v(" "),v("p",[t._v("首先客户端发送"),v("code",[t._v("SYN")]),t._v("给服务端，服务端接收到。")]),t._v(" "),v("p",[t._v("注意哦！现在服务端不是立刻回复 SYN + ACK，而是通过计算得到一个"),v("code",[t._v("SYN Cookie")]),t._v(", 将这个"),v("code",[t._v("Cookie")]),t._v("放到 TCP 报文的 "),v("code",[t._v("Fast Open")]),t._v("选项中，然后才给客户端返回。")]),t._v(" "),v("p",[t._v("客户端拿到这个 Cookie 的值缓存下来。后面正常完成三次握手。")]),t._v(" "),v("p",[t._v("首轮三次握手就是这样的流程。而后面的三次握手就不一样啦！")]),t._v(" "),v("h3",{attrs:{id:"后面的三次握手"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#后面的三次握手","aria-hidden":"true"}},[t._v("#")]),t._v(" 后面的三次握手")]),t._v(" "),v("p",[t._v("在后面的三次握手中，客户端会将之前缓存的 "),v("code",[t._v("Cookie")]),t._v("、"),v("code",[t._v("SYN")]),t._v(" 和"),v("code",[t._v("HTTP请求")]),t._v("(是的，你没看错)发送给服务端，服务端验证了 Cookie 的合法性，如果不合法直接丢弃；如果是合法的，那么就正常返回"),v("code",[t._v("SYN + ACK")]),t._v("。")]),t._v(" "),v("p",[t._v("重点来了，现在服务端能向客户端发 HTTP 响应了！这是最显著的改变，三次握手还没建立，仅仅验证了 Cookie 的合法性，就可以返回 HTTP 响应了。")]),t._v(" "),v("p",[t._v("当然，客户端的"),v("code",[t._v("ACK")]),t._v("还得正常传过来，不然怎么叫三次握手嘛。")]),t._v(" "),v("p",[t._v("流程如下:")]),t._v(" "),v("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://pic1.zhimg.com/80/v2-8400842fde097a15139515f3887c0e0c_720w.jpg",alt:"img"}}),t._v(" "),v("p",[t._v("注意: 客户端最后握手的 ACK 不一定要等到服务端的 HTTP 响应到达才发送，两个过程没有任何关系。")]),t._v(" "),v("h3",{attrs:{id:"tfo-的优势"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#tfo-的优势","aria-hidden":"true"}},[t._v("#")]),t._v(" TFO 的优势")]),t._v(" "),v("p",[t._v("TFO 的优势并不在与首轮三次握手，而在于后面的握手，在拿到客户端的 Cookie 并验证通过以后，可以直接返回 HTTP 响应，充分利用了"),v("strong",[t._v("1 个RTT")]),t._v("("),v("code",[t._v("Round-Trip Time，往返时延")]),t._v(")的时间"),v("strong",[t._v("提前进行数据传输")]),t._v("，积累起来还是一个比较大的优势。")])])}),[],!1,null,null,null);_.default=o.exports}}]);