(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{341:function(t,a,s){"use strict";s.r(a);var n=s(2),_=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_005-数据复制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_005-数据复制","aria-hidden":"true"}},[t._v("#")]),t._v(" 005 - 数据复制")]),t._v(" "),s("h2",{attrs:{id:"_1-概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 概念")]),t._v(" "),s("p",[t._v("好处：")]),t._v(" "),s("ul",[s("li",[t._v("高可用性")]),t._v(" "),s("li",[t._v("数据安全")]),t._v(" "),s("li",[t._v("分流/分工")])]),t._v(" "),s("p",[t._v("启动多个 Mongod 进程，并且在每个进程中对同一份数据保存多个备份，那么多个 Mongod 进程组成一个集群，叫做 "),s("code",[t._v("复制集")]),t._v(" 。")]),t._v(" "),s("p",[t._v("在复制集中，每一个 Mongod 的进程都叫做 "),s("code",[t._v("节点")]),t._v(" 。")]),t._v(" "),s("p",[t._v("不同的节点有不同的分工，每个复制集中都会有一个主节点，主节点负责处理所有客户发生的关于 "),s("code",[t._v("写")]),t._v(" 数据的请求（"),s("strong",[t._v("更新")]),t._v("或者是"),s("strong",[t._v("新增")]),t._v("）。")]),t._v(" "),s("p",[t._v("副节点会不停地从主节点上进行数据的备份和数据更新。")]),t._v(" "),s("p",[t._v("客户的读取请求在默认的情况下也仍然是由主节点进行处理的，但是可以进行选项配置静儿也可以从复制集中的副节点读取数据（但副节点的数据可能与主节点不同）。")]),t._v(" "),s("h3",{attrs:{id:"小总结："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小总结：","aria-hidden":"true"}},[t._v("#")]),t._v(" 小总结：")]),t._v(" "),s("ul",[s("li",[t._v("主节点负责处理所有的写入请求")]),t._v(" "),s("li",[t._v("主节点（默认）和副节点都可以处理读取请求")]),t._v(" "),s("li",[t._v("副节点从主节点（或者符合条件的副节点）处复制数据")]),t._v(" "),s("li",[t._v("每个节点都会向其他节点发送心跳请求")]),t._v(" "),s("li",[t._v("每隔2秒发送一次，超过10秒则请求超时（默认）")]),t._v(" "),s("li",[t._v("复制集中最多可以有50个节点（防止心跳请求太多）")])]),t._v(" "),s("h2",{attrs:{id:"_2-复制集选举querum"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-复制集选举querum","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 复制集选举Querum")]),t._v(" "),s("p",[t._v("复制集主节点由选举算法挑选出来。")]),t._v(" "),s("ul",[s("li",[t._v("候选节点发起选举，每个节点投票给比自己更同步的节点")]),t._v(" "),s("li",[t._v("得到超过半数选票的候选节点会当选为主节点")]),t._v(" "),s("li",[t._v("复制集中最多可以有7个投票节点")])]),t._v(" "),s("h3",{attrs:{id:"触发选举的事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发选举的事件","aria-hidden":"true"}},[t._v("#")]),t._v(" 触发选举的事件")]),t._v(" "),s("ul",[s("li",[t._v("主节点与副节点之间的心跳请求超时")]),t._v(" "),s("li",[t._v("复制集初始化")]),t._v(" "),s("li",[t._v("新节点加入复制集(也可以是之前坏掉的节点加入，也会触发)")])]),t._v(" "),s("h2",{attrs:{id:"_3-投票机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-投票机","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 投票机")]),t._v(" "),s("ul",[s("li",[t._v("没有数据")]),t._v(" "),s("li",[t._v("可以投票")]),t._v(" "),s("li",[t._v("不能成为主节点")])]),t._v(" "),s("h2",{attrs:{id:"_4-数据备份过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-数据备份过程","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 数据备份过程")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("初始同步（数据库，集合，索引，文档）")])]),t._v(" "),s("li",[s("p",[t._v("写库记录同步（local.oplog.rs）")]),t._v(" "),s("ul",[s("li",[t._v("写库日志中的记录可以被重复使用")]),t._v(" "),s("li",[t._v("多个线程分批次使用日志记录")]),t._v(" "),s("li",[t._v("写库日志的大小和文档大小不一定成正比")])])])]),t._v(" "),s("h2",{attrs:{id:"_5-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-命令","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 命令")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("# 创建完mongo进程后，初始化复制集\nrs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initiate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myset"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    members"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongol:27017"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongo2:27018"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongo3:27019"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n# 查看复制集状态\nrs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=_.exports}}]);