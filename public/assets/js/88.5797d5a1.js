(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{342:function(a,_,t){"use strict";t.r(_);var v=t(2),r=Object(v.a)({},(function(){var a=this,_=a.$createElement,t=a._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"_006-数据分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_006-数据分片","aria-hidden":"true"}},[a._v("#")]),a._v(" 006 - 数据分片")]),a._v(" "),t("h2",{attrs:{id:"_1-概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-概念","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. 概念")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("复制集—————————————————— "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 高可用性、 数据安全\n数据库分片—————————————— "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 可扩展性\n")])])]),t("h2",{attrs:{id:"_2-纵向扩展"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-纵向扩展","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 纵向扩展")]),a._v(" "),t("ul",[t("li",[a._v("增强单一服务器的性能")]),a._v(" "),t("li",[a._v("简单的架构和运维模型")]),a._v(" "),t("li",[a._v("单一服务器的性能上限")])]),a._v(" "),t("h2",{attrs:{id:"_3-横向扩展"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-横向扩展","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 横向扩展")]),a._v(" "),t("ul",[t("li",[a._v("增加提供服务的服务器数量")]),a._v(" "),t("li",[a._v("更高的可扩展性")]),a._v(" "),t("li",[a._v("增加架构和运维的复杂度")])]),a._v(" "),t("h2",{attrs:{id:"_4-分片集群结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-分片集群结构","aria-hidden":"true"}},[a._v("#")]),a._v(" 4. 分片集群结构")]),a._v(" "),t("p",[a._v("一个集群包含的组件：")]),a._v(" "),t("ol",[t("li",[a._v("mongos（一般和 App Server 一起放在同一台机器，但也可以放在不同的机器上）")]),a._v(" "),t("li",[a._v("各个分片（每个分片一般保存在不同的服务器上）")]),a._v(" "),t("li",[a._v("配置服务器")])]),a._v(" "),t("ul",[t("li",[a._v("每个分片存储一部分数据，可以部署为复制集")]),a._v(" "),t("li",[a._v("mongos 路由可以将客户请求发送至相关的分片")]),a._v(" "),t("li",[a._v("配置服务器保存集群配置和元数据，可以部署为复制集")])]),a._v(" "),t("h3",{attrs:{id:"主分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主分片","aria-hidden":"true"}},[a._v("#")]),a._v(" 主分片")]),a._v(" "),t("p",[a._v("MongoDB 允许集合不分片，它们放在一起叫做 "),t("code",[a._v("主分片")])]),a._v(" "),t("ul",[t("li",[a._v("集群中的每个数据库都会选择一个分片作为主分片")]),a._v(" "),t("li",[a._v("主分片存储所有不需要分片的集合")]),a._v(" "),t("li",[a._v("创建数据库时，数据最少的分片被选为主分片")])]),a._v(" "),t("h2",{attrs:{id:"_5-分片依据——片键"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-分片依据——片键","aria-hidden":"true"}},[a._v("#")]),a._v(" 5. 分片依据——片键")]),a._v(" "),t("ul",[t("li",[a._v("片键值被用来将集合中的文档划分为数据段")]),a._v(" "),t("li",[a._v("片键必须对应一个索引或索引前缀（单键或复合键）")]),a._v(" "),t("li",[a._v("可以使用片键值的哈希值来生成哈希片键")])]),a._v(" "),t("h3",{attrs:{id:"如何选择片键"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何选择片键","aria-hidden":"true"}},[a._v("#")]),a._v(" 如何选择片键")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("要求")]),a._v(" "),t("th",[a._v("解决方案")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("片键值的范围应该更广")]),a._v(" "),t("td",[a._v("可使用复合片键扩大范围")])]),a._v(" "),t("tr",[t("td",[a._v("片键值的分布应该更平衡")]),a._v(" "),t("td",[a._v("可使用复合片键平衡分布")])]),a._v(" "),t("tr",[t("td",[a._v("片键值不要单向增大/减小, 比如自动生成的ObjectId（因为可能也会导致文档分配不平衡）")]),a._v(" "),t("td",[a._v("可使用哈希片键")])])])]),a._v(" "),t("h2",{attrs:{id:"_6-动态平衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-动态平衡","aria-hidden":"true"}},[a._v("#")]),a._v(" 6. 动态平衡")]),a._v(" "),t("h3",{attrs:{id:"数据段分裂"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据段分裂","aria-hidden":"true"}},[a._v("#")]),a._v(" 数据段分裂")]),a._v(" "),t("ul",[t("li",[a._v("数据段尺寸过大或包含过多文档时触发数据段分裂")]),a._v(" "),t("li",[a._v("只有新增/更新文档时才可能自动触发数据段分裂")]),a._v(" "),t("li",[a._v("数据段分裂通过更新元数据来实现")])]),a._v(" "),t("h3",{attrs:{id:"集群的平衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群的平衡","aria-hidden":"true"}},[a._v("#")]),a._v(" 集群的平衡")]),a._v(" "),t("p",[a._v("分片之间包含的数据段差额较大，MongoDB 后台的平衡器将进行数据迁移，使集群中的分片平衡。")]),a._v(" "),t("ul",[t("li",[a._v("后台运行的平衡器负责监视和调整集群的平衡")]),a._v(" "),t("li",[a._v("当最大和最小分片之间的数据段数量相差过大时触发")]),a._v(" "),t("li",[a._v("集群中添加或移除分片时也会触发")])]),a._v(" "),t("h2",{attrs:{id:"_7-分片集群——配置服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-分片集群——配置服务器","aria-hidden":"true"}},[a._v("#")]),a._v(" 7. 分片集群——配置服务器")]),a._v(" "),t("ul",[t("li",[a._v("存储各分片数据段列表和数据段范围")]),a._v(" "),t("li",[a._v("存储集群的认证和授权配置")]),a._v(" "),t("li",[a._v("不同的集群不要共用配置服务器")])]),a._v(" "),t("h3",{attrs:{id:"配置服务器以复制集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置服务器以复制集","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置服务器以复制集")]),a._v(" "),t("ul",[t("li",[a._v("主节点故障时，在暂时没有主节点时，配置服务器进入"),t("strong",[a._v("只读模式")])]),a._v(" "),t("li",[a._v("只读模式下， "),t("code",[a._v("数据段分裂")]),a._v(" 和 "),t("code",[a._v("集群平衡")]),a._v(" 都不可执行")]),a._v(" "),t("li",[a._v("整个复制集故障时，分片集群不可用")])]),a._v(" "),t("h2",{attrs:{id:"_8-mongos-路由"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-mongos-路由","aria-hidden":"true"}},[a._v("#")]),a._v(" 8. Mongos(路由)")]),a._v(" "),t("h3",{attrs:{id:"分片查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分片查询","aria-hidden":"true"}},[a._v("#")]),a._v(" 分片查询")]),a._v(" "),t("ul",[t("li",[a._v("客户请求应发给 mongos，而不是分片服务器")]),a._v(" "),t("li",[a._v("当查询包含分片片键时，mongos 将查询发送到指定分片")]),a._v(" "),t("li",[a._v("当查询字段不包含分片片键时，mongos 将查询发送到所有分片，并汇总所有查询结果")])])])}),[],!1,null,null,null);_.default=r.exports}}]);