<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>八、ES11新特性（2020） | Half Town前端周刊</title>
    <meta name="description" content="白糖炒栗子哒前端Blog">
    <link rel="icon" href="/favicon.ico">
  <link rel="mainfest" href="/mainfest.json">
    
    <link rel="preload" href="/assets/css/0.styles.d4c32f31.css" as="style"><link rel="preload" href="/assets/js/app.b1906b97.js" as="script"><link rel="preload" href="/assets/js/2.bdee5faf.js" as="script"><link rel="preload" href="/assets/js/43.343b309f.js" as="script"><link rel="preload" href="/assets/js/7.f0379e88.js" as="script"><link rel="preload" href="/assets/js/8.e132ed9d.js" as="script"><link rel="prefetch" href="/assets/js/10.e085a21c.js"><link rel="prefetch" href="/assets/js/100.78a0b04f.js"><link rel="prefetch" href="/assets/js/101.02ef3e98.js"><link rel="prefetch" href="/assets/js/102.cdd542e1.js"><link rel="prefetch" href="/assets/js/103.de748a03.js"><link rel="prefetch" href="/assets/js/104.7455cba5.js"><link rel="prefetch" href="/assets/js/105.68a805c9.js"><link rel="prefetch" href="/assets/js/106.a2ff7e85.js"><link rel="prefetch" href="/assets/js/107.36f34ab6.js"><link rel="prefetch" href="/assets/js/108.f26732f6.js"><link rel="prefetch" href="/assets/js/109.8d05e086.js"><link rel="prefetch" href="/assets/js/11.f2fd41dc.js"><link rel="prefetch" href="/assets/js/110.c7f84bd1.js"><link rel="prefetch" href="/assets/js/111.0cdf0d73.js"><link rel="prefetch" href="/assets/js/12.450e705b.js"><link rel="prefetch" href="/assets/js/13.50973e7a.js"><link rel="prefetch" href="/assets/js/14.40fad099.js"><link rel="prefetch" href="/assets/js/15.a2d432ad.js"><link rel="prefetch" href="/assets/js/16.4ad6c82f.js"><link rel="prefetch" href="/assets/js/17.1bc86885.js"><link rel="prefetch" href="/assets/js/18.ade73665.js"><link rel="prefetch" href="/assets/js/19.a0f47a6e.js"><link rel="prefetch" href="/assets/js/20.5499b902.js"><link rel="prefetch" href="/assets/js/21.86afe090.js"><link rel="prefetch" href="/assets/js/22.29fa6f17.js"><link rel="prefetch" href="/assets/js/23.1af6f734.js"><link rel="prefetch" href="/assets/js/24.933ea1dd.js"><link rel="prefetch" href="/assets/js/25.7b5dc5f0.js"><link rel="prefetch" href="/assets/js/26.03194069.js"><link rel="prefetch" href="/assets/js/27.eb1fac5c.js"><link rel="prefetch" href="/assets/js/28.01df134d.js"><link rel="prefetch" href="/assets/js/29.697d4c02.js"><link rel="prefetch" href="/assets/js/3.77f61fb0.js"><link rel="prefetch" href="/assets/js/30.e1b58026.js"><link rel="prefetch" href="/assets/js/31.41db2b44.js"><link rel="prefetch" href="/assets/js/32.9f2db749.js"><link rel="prefetch" href="/assets/js/33.03b6d68a.js"><link rel="prefetch" href="/assets/js/34.09609909.js"><link rel="prefetch" href="/assets/js/35.c80be0ac.js"><link rel="prefetch" href="/assets/js/36.d15e6050.js"><link rel="prefetch" href="/assets/js/37.1ccd8184.js"><link rel="prefetch" href="/assets/js/38.ab0d4b98.js"><link rel="prefetch" href="/assets/js/39.8301eaad.js"><link rel="prefetch" href="/assets/js/4.90b687b0.js"><link rel="prefetch" href="/assets/js/40.d95907af.js"><link rel="prefetch" href="/assets/js/41.33845e14.js"><link rel="prefetch" href="/assets/js/42.8a256266.js"><link rel="prefetch" href="/assets/js/44.e61b9da2.js"><link rel="prefetch" href="/assets/js/45.0eea8be7.js"><link rel="prefetch" href="/assets/js/46.861203d9.js"><link rel="prefetch" href="/assets/js/47.ae5bd907.js"><link rel="prefetch" href="/assets/js/48.1dbfd265.js"><link rel="prefetch" href="/assets/js/49.87f2ea7e.js"><link rel="prefetch" href="/assets/js/5.06355c1f.js"><link rel="prefetch" href="/assets/js/50.92bcf9cd.js"><link rel="prefetch" href="/assets/js/51.2b54e26b.js"><link rel="prefetch" href="/assets/js/52.ef61db16.js"><link rel="prefetch" href="/assets/js/53.e8411588.js"><link rel="prefetch" href="/assets/js/54.6f0a7cd7.js"><link rel="prefetch" href="/assets/js/55.40d0a721.js"><link rel="prefetch" href="/assets/js/56.76ff8ce6.js"><link rel="prefetch" href="/assets/js/57.cfea78e2.js"><link rel="prefetch" href="/assets/js/58.f8c35f3d.js"><link rel="prefetch" href="/assets/js/59.02cbb18a.js"><link rel="prefetch" href="/assets/js/6.d108277e.js"><link rel="prefetch" href="/assets/js/60.2df7b32b.js"><link rel="prefetch" href="/assets/js/61.16805fc4.js"><link rel="prefetch" href="/assets/js/62.ef5ca102.js"><link rel="prefetch" href="/assets/js/63.923718a5.js"><link rel="prefetch" href="/assets/js/64.d40092dd.js"><link rel="prefetch" href="/assets/js/65.d68a358c.js"><link rel="prefetch" href="/assets/js/66.b4323cbe.js"><link rel="prefetch" href="/assets/js/67.3a9004c1.js"><link rel="prefetch" href="/assets/js/68.350f6fbb.js"><link rel="prefetch" href="/assets/js/69.fdebae43.js"><link rel="prefetch" href="/assets/js/70.ccac64ba.js"><link rel="prefetch" href="/assets/js/71.8948f6c8.js"><link rel="prefetch" href="/assets/js/72.f5d07472.js"><link rel="prefetch" href="/assets/js/73.c2ddba1b.js"><link rel="prefetch" href="/assets/js/74.7a96d852.js"><link rel="prefetch" href="/assets/js/75.d452b4b5.js"><link rel="prefetch" href="/assets/js/76.5eac82cb.js"><link rel="prefetch" href="/assets/js/77.49a8f94c.js"><link rel="prefetch" href="/assets/js/78.17478c01.js"><link rel="prefetch" href="/assets/js/79.545a2920.js"><link rel="prefetch" href="/assets/js/80.172aeb42.js"><link rel="prefetch" href="/assets/js/81.6376c78a.js"><link rel="prefetch" href="/assets/js/82.1dfa8f89.js"><link rel="prefetch" href="/assets/js/83.fc10680d.js"><link rel="prefetch" href="/assets/js/84.41df0212.js"><link rel="prefetch" href="/assets/js/85.b57d2894.js"><link rel="prefetch" href="/assets/js/86.1bed09b1.js"><link rel="prefetch" href="/assets/js/87.3bc2e0cf.js"><link rel="prefetch" href="/assets/js/88.5797d5a1.js"><link rel="prefetch" href="/assets/js/89.cfc4d086.js"><link rel="prefetch" href="/assets/js/9.17617c7c.js"><link rel="prefetch" href="/assets/js/90.d3796c5b.js"><link rel="prefetch" href="/assets/js/91.f9e0f122.js"><link rel="prefetch" href="/assets/js/92.8ce6ae6a.js"><link rel="prefetch" href="/assets/js/93.f1c144ce.js"><link rel="prefetch" href="/assets/js/94.1877adf1.js"><link rel="prefetch" href="/assets/js/95.41ce2c18.js"><link rel="prefetch" href="/assets/js/96.07be3e30.js"><link rel="prefetch" href="/assets/js/97.d6ecd209.js"><link rel="prefetch" href="/assets/js/98.b1431a2d.js"><link rel="prefetch" href="/assets/js/99.acea4094.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4c32f31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Half Town前端周刊</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link">目录</a></div><div class="nav-item"><a href="https://github.com/LSKReno" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://weibo.com/u/5092674629" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://lskreno.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LSKReno的 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/posts/" class="sidebar-link">目录</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结前端技术文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ES6-11新特性</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es6-11/001preface/" class="sidebar-link">前言</a></li><li><a href="/es6-11/002birth/" class="sidebar-link">一、JavaScript的诞生</a></li><li><a href="/es6-11/003es-js-relationship/" class="sidebar-link">二、JavaScript 与 ECMAScript 的关系</a></li><li><a href="/es6-11/004es6/" class="sidebar-link">三、ES6 新特性（2015）</a></li><li><a href="/es6-11/005es7/" class="sidebar-link">四、ES7新特性（2016）</a></li><li><a href="/es6-11/006es8/" class="sidebar-link">五、ES8 新特性（2017）</a></li><li><a href="/es6-11/007es9/" class="sidebar-link">六、ES9新特性（2018）</a></li><li><a href="/es6-11/008es10/" class="sidebar-link">七、ES10新特性（2019）</a></li><li><a href="/es6-11/009es11/" class="active sidebar-link">八、ES11新特性（2020）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_1-promise-allsettled" class="sidebar-link">1. Promise.allSettled</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6-11/009es11/#promise-all-缺陷" class="sidebar-link">Promise.all 缺陷</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#promise-allsettled-的优势" class="sidebar-link">Promise.allSettled 的优势</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_2-可选链" class="sidebar-link">2. 可选链</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_3-空值合并运算符" class="sidebar-link">3. 空值合并运算符</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_4-dynamic-import" class="sidebar-link">4.dynamic-import</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_5-globalthis" class="sidebar-link">5.globalThis</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_6-bigint" class="sidebar-link">6. BigInt</a></li><li class="sidebar-sub-header"><a href="/es6-11/009es11/#_7-string-prototype-matchall" class="sidebar-link">7. String.prototype.matchAll</a></li></ul></li><li><a href="/es6-11/010reference/" class="sidebar-link">参考链接</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入JavaScript系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Browser浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS-API揭秘系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搞懂那个TCP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>这个面试不太难</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写JS系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Koa大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB大赏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端架构设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端模块化规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自动化测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue-cli的配置详解</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="八、es11新特性（2020）"><a href="#八、es11新特性（2020）" aria-hidden="true" class="header-anchor">#</a> 八、ES11新特性（2020）</h1> <p><div data-v-21553e4a><p data-v-21553e4a><strong data-v-21553e4a>Hey mate, Please know that</strong></p> <div data-v-21553e4a>坚持比努力更可怕</div> <div class="seperator" data-v-21553e4a></div></div></p> <h2 id="_1-promise-allsettled"><a href="#_1-promise-allsettled" aria-hidden="true" class="header-anchor">#</a> 1. Promise.allSettled</h2> <h3 id="promise-all-缺陷"><a href="#promise-all-缺陷" aria-hidden="true" class="header-anchor">#</a> Promise.all 缺陷</h3> <p>都知道 <code>Promise.all</code> 具有并发执行异步任务的能力。但它的最大问题就是如果其中某个任务出现异常( <code>reject</code> )，所有任务都会挂掉， <code>Promise</code> 直接进入 <code>reject</code> 状态。</p> <p>想象这个场景：你的页面有三个区域，分别对应三个独立的接口数据，使用 <code>Promise.all</code> 来并发三个接口，如果其中任意一个接口服务异常，状态是 reject, 这会导致页面中该三个区域数据全都无法渲染出来，因为任何 <code>reject</code> 都会进入 catch 回调, 很明显，这是无法接受的，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            msg<span class="token punctuation">:</span> <span class="token string">'服务异常'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果其中一个任务是 reject，则不会执行到这个回调。</span>
        <span class="token function">RenderContent</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 本例中会执行到这个回调</span>
        <span class="token comment">// error: {code: 500, msg: &quot;服务异常&quot;}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="promise-allsettled-的优势"><a href="#promise-allsettled-的优势" aria-hidden="true" class="header-anchor">#</a> Promise.allSettled 的优势</h3> <p>我们需要一种机制，如果并发任务中，无论一个任务正常或者异常，都会返回对应的的状态（ <code>fulfilled</code> 或者 <code>rejected</code> ）与结果（业务 <code>value</code> 或者 拒因 <code>reason</code> ），在 <code>then</code> 里面通过 <code>filter</code> 来过滤出想要的业务逻辑结果，这就能最大限度的保障业务当前状态的可访问性，而 <code>Promise.allSettled</code> 就是解决这问题的。</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
            msg<span class="token punctuation">:</span> <span class="token string">'服务异常'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
            0: {status: &quot;rejected&quot;, reason: {...}}
            1: {status: &quot;fulfilled&quot;, value: {...}}
            2: {status: &quot;fulfilled&quot;, value: {...}}
        */</span>
        <span class="token comment">// 过滤掉 rejected 状态，尽可能多的保证页面区域数据渲染</span>
        <span class="token function">RenderContent</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> el<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-可选链"><a href="#_2-可选链" aria-hidden="true" class="header-anchor">#</a> 2. 可选链</h2> <p><code>可选链</code> 可让我们在查询具有多层级的对象时，不再需要进行冗余的各种前置校验。</p> <p>日常开发中，我们经常会遇到这种查询</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><p>又或是这种</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> age <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span>getAge <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>info<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这是一种丑陋但又不得不做的前置校验，否则很容易命中 <code>Uncaught TypeError: Cannot read property...</code> 这种错误，这极有可能让你整个应用挂掉。</p> <p>用了 Optional Chaining ，上面代码会变成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> user <span class="token operator">?</span> <span class="token punctuation">.</span>info <span class="token operator">?</span> <span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token keyword">var</span> age <span class="token operator">=</span> user <span class="token operator">?</span> <span class="token punctuation">.</span>info <span class="token operator">?</span> <span class="token punctuation">.</span>getAge <span class="token operator">?</span> <span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可选链中的 <code>?</code> 表示如果问号左边表达式有值, 就会继续查询问号后面的字段。根据上面可以看出，用可选链可以大量简化类似繁琐的前置校验操作，而且更安全。</p> <h2 id="_3-空值合并运算符"><a href="#_3-空值合并运算符" aria-hidden="true" class="header-anchor">#</a> 3. 空值合并运算符</h2> <p>当我们查询某个属性时，经常会遇到，如果没有该属性就会设置一个默认的值。比如下面代码中查询玩家等级。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>data<span class="token punctuation">.</span>level<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
</code></pre></div><p>在 JS 中，空字符串、0 等，当进行逻辑操作符判断时，会自动转化为 false。在上面的代码里，如果玩家等级本身就是 0 级, 变量 level 就会被赋值 <code>暂无等级</code> 字符串，这是逻辑错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> user<span class="token punctuation">.</span>level <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    level <span class="token operator">=</span> user<span class="token punctuation">.</span>level<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">elseif</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">!</span>user<span class="token punctuation">.</span>level</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    level <span class="token operator">=</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    level <span class="token operator">=</span> user<span class="token punctuation">.</span>level<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>来看看用空值合并运算符如何处理</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// {</span>
<span class="token comment">//   &quot;level&quot;: 0</span>
<span class="token comment">// }</span>
<span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">级</span><span class="token template-punctuation string">`</span></span> <span class="token operator">?</span> <span class="token operator">?</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
<span class="token comment">// level -&gt; '0级'</span>
</code></pre></div><p>用空值合并运算在逻辑正确的前提下，代码更加简洁。</p> <p><strong>空值合并运算符</strong> 与 <strong>可选链</strong> 相结合，可以很轻松处理多级查询并赋予默认值问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> level <span class="token operator">=</span> user<span class="token punctuation">.</span>data <span class="token operator">?</span> <span class="token punctuation">.</span>level <span class="token operator">?</span> <span class="token operator">?</span> <span class="token string">'暂无等级'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-dynamic-import"><a href="#_4-dynamic-import" aria-hidden="true" class="header-anchor">#</a> 4.dynamic-import</h2> <p>按需 <code>import</code> 提案几年前就已提出，如今终于能进入 ES 正式规范。这里个人理解成 &quot;<strong>按需</strong>&quot; 更为贴切。现代前端打包资源越来越大，打包成几 M 的 JS 资源已成常态，而往往前端应用初始化时根本不需要全量加载逻辑资源，为了首屏渲染速度更快，很多时候都是按需加载，比如懒加载图片等。而这些按需执行逻辑资源都体现在某一个事件回调中去加载。</p> <div class="language-js extra-class"><pre class="language-js"><code>el<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/path/current-logic.js</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            module<span class="token punctuation">.</span><span class="token function">doSomthing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// load error;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，webpack 目前已很好的支持了该特性。</p> <h2 id="_5-globalthis"><a href="#_5-globalthis" aria-hidden="true" class="header-anchor">#</a> 5.globalThis</h2> <p>JavaScript 在不同的环境获取全局对象有不同的方式，NodeJS 中通过 <code>global</code> , Web 中通过 <code>window</code> , <code>self</code> 等，有些甚至通过 <code>this</code> 获取，但通过 <code>this</code> 是及其危险的， <code>this</code> 在 JavaScript 中异常复杂，它严重依赖当前的执行上下文，这些无疑增加了获取全局对象的复杂性。</p> <p>过去获取全局对象，可通过一个全局函数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">getGlobal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> self<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeofwindow <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        returnwindow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> global<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unable to locate global object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> globals <span class="token operator">=</span> <span class="token function">getGlobal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis</span>
</code></pre></div><p>而 <code>globalThis</code> 目的就是提供一种标准化方式访问全局对象，有了 <code>globalThis</code> 后，你可以在任意上下文，任意时刻都能获取到全局对象。</p> <h2 id="_6-bigint"><a href="#_6-bigint" aria-hidden="true" class="header-anchor">#</a> 6. BigInt</h2> <p>JavaScript 中 <code>Number</code> 类型只能安全的表示 <code>-(2^53-1)</code> 至 <code>2^53-1</code> 范的值，即 <code>Number.MIN_SAFE_INTEGER</code> 至 <code>Number.MAX_SAFE_INTEGER</code> ，超出这个范围的整数计算或者表示会丢失精度。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> num <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740991</span>

num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740992</span>

<span class="token comment">// 再次加 +1 后无法正常运算</span>
num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 9007199254740992</span>

<span class="token comment">// 两个不同的值，却返回了true</span>
<span class="token number">9007199254740992</span> <span class="token operator">===</span> <span class="token number">9007199254740993</span> <span class="token comment">// -&gt; true</span>
</code></pre></div><p>为解决此问题，ES2020 提供一种新的数据类型： <code>BigInt</code> 。使用 <code>BigInt</code> 有两种方式：</p> <ol><li>在整数字面量后面加 <code>n</code> 。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigIntNum <span class="token operator">=</span> <span class="token number">9007199254740993n</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>使用 <code>BigInt</code> 函数。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigIntNum <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">9007199254740</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> anOtherBigIntNum <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token string">'9007199254740993'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过 <code>BigInt</code> ， 我们可以安全的进行大数整型计算。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bigNumRet <span class="token operator">=</span> <span class="token number">9007199254740993n</span> <span class="token operator">+</span> <span class="token number">9007199254740993n</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; -&gt; 18014398509481986n</span>

bigNumRet<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; '18014398509481986'</span>
</code></pre></div><p>注意:</p> <ol><li><code>BigInt</code> 是一种新的数据原始（primitive）类型。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>typeof9007199254740993n<span class="token punctuation">;</span> <span class="token comment">// -&gt; 'bigint'</span>
</code></pre></div><ol><li>尽可能避免通过调用函数 <code>BigInt</code> 方式来实例化超大整型。因为参数的字面量实际也是 <code>Number</code> 类型的一次实例化，超出安全范围的数字，可能会引起精度丢失。</li></ol> <h2 id="_7-string-prototype-matchall"><a href="#_7-string-prototype-matchall" aria-hidden="true" class="header-anchor">#</a> 7. String.prototype.matchAll</h2> <blockquote><p>The <code>matchAll()</code> method returns an iterator of all results matching a string against a regular expression, including capturing groups.——MDN</p></blockquote> <p>思考下面代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/g</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// -&gt; [&quot;&lt;text&gt;JS&lt;/text&gt;&quot;, &quot;&lt;text&gt;正则&lt;/text&gt;&quot;]</span>
</code></pre></div><p>可以看出返回的数组里包含了父匹配项，但未匹配到子项（group）。移除全局搜索符&quot; <code>g</code> &quot;试试。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span>
<span class="token comment">// 注意这里没有全局搜素标示符&quot;g&quot;</span>
<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上面会打印出</span>
<span class="token comment">/*
[
    &quot;&lt;text&gt;JS&lt;/text&gt;&quot;,
    &quot;JS&quot;,
    index: 0,
    input:
    &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,
    groups: undefined
]
*/</span>
</code></pre></div><p>这样可以获取到匹配的父项，包括子项（group），但只能获取到第一个满足的匹配字符。能看出上面无法匹配到 <code>正则</code> 。</p> <p>如果获取到全局所有匹配项，包括子项呢？</p> <p>ES2020 提供了一种简易的方式： <code>String.prototype.matchAll</code> , 该方法会返回一个迭代器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> allMatchs <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex">/&lt;\w+&gt;(.*?)&lt;\/\w+&gt;/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match <span class="token keyword">of</span> allMatchs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
第一次迭代返回：
[
    &quot;&lt;text&gt;JS&lt;/text&gt;&quot;,
    &quot;JS&quot;,
    index: 0,
    input: &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,
    groups: undefined
]

第二次迭代返回：
[
    &quot;&lt;text&gt;正则&lt;/text&gt;&quot;,
    &quot;正则&quot;,
    index: 15,
    input: &quot;&lt;text&gt;JS&lt;/text&gt;&lt;text&gt;正则&lt;/text&gt;&quot;,
    groups: undefined
]
*/</span>
</code></pre></div><p>能看出每次迭代中可获取所有的匹配，以及本次匹配的成功的一些其他元信息。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">5/27/2020, 10:57:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/es6-11/008es10/" class="prev">
          七、ES10新特性（2019）
        </a></span> <span class="next"><a href="/es6-11/010reference/">
          参考链接
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b1906b97.js" defer></script><script src="/assets/js/2.bdee5faf.js" defer></script><script src="/assets/js/43.343b309f.js" defer></script><script src="/assets/js/7.f0379e88.js" defer></script><script src="/assets/js/8.e132ed9d.js" defer></script>
  </body>
</html>
